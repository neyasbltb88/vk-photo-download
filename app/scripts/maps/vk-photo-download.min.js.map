{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app/scripts/modules/photo-download.js","app/scripts/modules/templates.js","app/scripts/vk-photo-download.js","node_modules/downloadjs/download.js"],"names":[],"mappings":"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,KAAK,SAAL,CAAe,kBAZd,qBAY2C,KAAK,SAAL,CAAe,gBAZ1D,qEAeD,KAAK,SAAL,CAAe,kBAfd,eAeqC,KAAK,SAAL,CAAe,gBAfpD,8YA4ByB,KAAK,KAAL,CAAW,GAAX,CAAe,OAAf,CA5BzB,+PAmCyB,KAAK,KAAL,CAAW,GAAX,CAAe,OAAf,CAnCzB,sCAqCD,KAAK,SAAL,CAAe,gBArCd;AAAA;AA0CH,K,CAAC;;;;;;;;;;;;AChFV;;;;AAGA,MAAM,CAAC,aAAP,GAAuB,IAAI,sBAAJ,EAAvB;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../vk-photo-download.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import Download from 'downloadjs';\r\nimport PhotoDownloadTemplates from './templates';\r\n\r\nexport default class PhotoDownload {\r\n    constructor(params = {}) {\r\n        // Ссылка, в которую обернута картинка, \r\n        // здесь нужнв для триггера создания/обновления кнопки\r\n        this.imgContainer_id = 'pv_photo';\r\n\r\n        this.selectors = {\r\n            // id контейнера кнопки\r\n            photoDownload_id: 'PhotoDownload',\r\n            // Контейнер, в котором находится картинка и элементы управления,\r\n            // создавать кнопку будем в нем\r\n            imgContainer_class: 'pv_image_wrap',\r\n            // id, который добавится тегу style\r\n            style_id: 'PhotoDownloadStyle',\r\n        };\r\n\r\n        this.template = new PhotoDownloadTemplates({\r\n            selectors: this.selectors\r\n        });\r\n\r\n        // Объект с описанием обработчиков\r\n        this.triggers = {\r\n            mouseover: [\r\n                // Селектор ссылки, в которую обернута картинка в просмотрщике\r\n                {\r\n                    type: 'id',\r\n                    selector: this.imgContainer_id,\r\n                    handler: this._updateBtn,\r\n                    child: true,\r\n                },\r\n                {\r\n                    type: 'class',\r\n                    selector: 'PhotoDownload_btn',\r\n                    handler: this._updateBtn,\r\n                    child: true,\r\n                },\r\n            ], // Конец mouseover\r\n        };\r\n\r\n        this.last_image_data = {\r\n            src: null,\r\n            width: null,\r\n            height: null,\r\n        };\r\n\r\n\r\n        // Точка входа\r\n        this.init();\r\n    }\r\n\r\n    _updateBtn(elem) {\r\n        let parent = elem.closest('.' + this.selectors.imgContainer_class);\r\n\r\n        // Если в родительском контейнере еще нет кнопки\r\n        if (!parent.querySelector('#' + this.selectors.photoDownload_id)) {\r\n            // то создадим ее\r\n            this._createDownloadContainer(elem);\r\n        }\r\n\r\n        let btn = parent.querySelector('.PhotoDownload_btn');\r\n        let size = parent.querySelector('.PhotoDownload_size');\r\n        this.last_image_data = window.Photoview.genData(cur.pvCurPhoto);\r\n\r\n        // Если ссылка в кнопке не та, которая нужна сейчас\r\n        if (btn.href !== this.last_image_data.src) {\r\n            console.log('btn.href !== this.last_image_data.src');\r\n\r\n            btn.href = this.last_image_data.src;\r\n\r\n            if (this.last_image_data.width && this.last_image_data.height) {\r\n                size.classList.remove('non_size');\r\n                size.textContent = `${this.last_image_data.width}x${this.last_image_data.height}`;\r\n            } else {\r\n                size.classList.add('non_size');\r\n                size.textContent = '';\r\n            }\r\n        }\r\n    }\r\n\r\n    _createDownloadContainer(elem) {\r\n        let parent = elem.closest('.' + this.selectors.imgContainer_class);\r\n        let wrap = document.createElement('div');\r\n        wrap.id = this.selectors.photoDownload_id;\r\n\r\n        wrap.innerHTML = this.template.getInnerElems();\r\n\r\n        setTimeout(() => {\r\n            wrap.classList.add('ready');\r\n        }, 0);\r\n\r\n        parent.appendChild(wrap);\r\n    }\r\n\r\n    _checkComplianceChild(target, trigger) {\r\n        let parent = (trigger.type === 'id') ?\r\n            target.closest('#' + trigger.selector) :\r\n            target.closest('.' + trigger.selector);\r\n\r\n        if (parent) {\r\n            this._checkComplianceTarget(parent, trigger);\r\n        }\r\n    }\r\n\r\n    _checkComplianceTarget(target, trigger) {\r\n        let compliance = false;\r\n\r\n        // Два отдельных условия для того, чтобы была возможность назначить\r\n        // разные обработчики по id и по классу на один элемент, и они сработали оба\r\n        if (trigger.type === 'id') {\r\n            if (target.id === trigger.selector) {\r\n                compliance = true;\r\n\r\n                if (trigger.handler) {\r\n                    // console.log('> ' + trigger.selector);\r\n                    trigger.handler.call(this, target);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (trigger.type === 'class') {\r\n            if (target.classList.contains(trigger.selector)) {\r\n                compliance = true;\r\n\r\n                if (trigger.handler) {\r\n                    // console.log('> ' + trigger.selector);\r\n                    trigger.handler.call(this, target);\r\n                }\r\n            }\r\n        }\r\n\r\n        return compliance;\r\n    }\r\n\r\n    // Метод, который вызывает нужный обработчик при нужном событии\r\n    _watchTrigger(event) {\r\n        // Смотрим, есть ли обработчики полученного типа события\r\n        // На самом деле они всегда должны быть, но все же\r\n        let triggers = this.triggers[event.type];\r\n        if (triggers === undefined) return;\r\n\r\n        // Берем элемент, на котором сработало событие\r\n        let target = event.target;\r\n\r\n        // Цикл по объекту обработчиков полученного типа события\r\n        triggers.forEach(trigger => {\r\n            // Если цели события нет в объекте обработчиков, но в обработчике указано, \r\n            // что он может срабатывать на дочернем элементе\r\n            if (!this._checkComplianceTarget(target, trigger) && trigger.child) {\r\n                // Попробуем найти родительский элемент цели, соответствующий селектору\r\n                // из объекта обработчиков\r\n                this._checkComplianceChild(target, trigger);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Установка на document слушателей типов событий, имеющихся в объекте обработчиков\r\n    _initWatcher() {\r\n        let types = Object.keys(this.triggers);\r\n        types.forEach(type => document.addEventListener(type, this._watchTrigger.bind(this)))\r\n    }\r\n\r\n    // Метод добавления на страницу стилей, необходимых для работы PhotoDownload\r\n    _injectCSS() {\r\n        let style = document.createElement('style');\r\n        style.id = this.selectors.style_id;\r\n        style.textContent = this.template.getStyleContent();\r\n\r\n        document.head.appendChild(style);\r\n    }\r\n\r\n\r\n    // Точка входа\r\n    init() {\r\n        console.log('%c%s', (window.log_color) ? window.log_color.blue : '', 'PhotoDownload: Init');\r\n\r\n        // Добавляем стили PhotoDownload\r\n        this._injectCSS();\r\n\r\n        // Инициализируем обработчики событий\r\n        this._initWatcher();\r\n    }\r\n}","export default class PhotoDownloadTemplates {\r\n    constructor(params = {}) {\r\n            this.selectors = params.selectors;\r\n\r\n            // Объект, генерирующий разноцветные иконки\r\n            this.icons = {\r\n                _colors: {\r\n                    green: '#00B75A',\r\n                    red: '#F92672',\r\n                    white: '#FFFFFF',\r\n                    yellow: '#FFC000',\r\n                },\r\n                _prefix: 'data:image/svg+xml;charset=utf-8,',\r\n                /* html */\r\n                _template: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\">\r\n                            <path fill=\"{{color}}\" d=\"M 4,0 4,8 0,8 8,16 16,8 12,8 12,0 4,0 z\"/>\r\n                        </svg>`,\r\n                _temp: function(color) {\r\n                    return this._template.replace(/\\{\\{.*\\}\\}/gm, color ? color : 'white');\r\n                },\r\n                get(color, url = true) {\r\n                    let _color = this._colors[color] ? this._colors[color] : color;\r\n                    let svg = this._temp(_color).replace(/[\\s]{2,}/gm, ' ');\r\n                    return url ? this._prefix + encodeURIComponent(svg) : svg;\r\n                }\r\n            };\r\n        } // constructor\r\n\r\n    getInnerElems() {\r\n        return /* html */ `\r\n            <a class=\"PhotoDownload_btn\" href=\"#!\" target=\"_blank\" draggable=\"false\">\r\n                <div class=\"PhotoDownload_icon\"></div>\r\n                <div class=\"PhotoDownload_size\"></div>\r\n            </a>\r\n        `;\r\n    }\r\n\r\n    getStyleContent() {\r\n            return /* css */ `\r\n        #${this.selectors.photoDownload_id} {\r\n            background-color: #000;\r\n            border-top-left-radius: 4px;\r\n            position: absolute;\r\n            bottom: 0;\r\n            left: 100%;\r\n            opacity: 0;\r\n            transform: translate3d(-38px, 0, 1px);\r\n            will-change: transform, opacity;\r\n            transition: opacity .25s ease-in-out, transform .25s ease-in-out !important;\r\n        }\r\n        .${this.selectors.imgContainer_class}:hover #${this.selectors.photoDownload_id}.ready {\r\n            opacity: .3;\r\n        }\r\n        .${this.selectors.imgContainer_class} #${this.selectors.photoDownload_id}.ready:hover {\r\n            opacity: .8;\r\n            transform: translate3d(-100%, 0, 1px);\r\n        }\r\n        .PhotoDownload_btn {\r\n            display: flex;\r\n            align-items: center;\r\n            padding: 10px;\r\n        }\r\n        .PhotoDownload_btn:hover {\r\n            text-decoration: none;\r\n        }\r\n        .PhotoDownload_icon {\r\n            background-image: url('${this.icons.get('white')}');\r\n            background-size: contain;\r\n            background-repeat: no-repeat;\r\n            height: 18px;\r\n            width: 18px;\r\n        }\r\n        .PhotoDownload_btn:hover .PhotoDownload_icon {\r\n            background-image: url('${this.icons.get('green')}');\r\n        }\r\n        #${this.selectors.photoDownload_id} .PhotoDownload_size:not(.non_size) {\r\n            padding-left: 10px;\r\n            color: #C3CFE0 !important;\r\n        }\r\n        `;\r\n        } // getStyleContent\r\n\r\n}","import PhotoDownload from './modules/photo-download';\r\n\r\n\r\nwindow.photoDownload = new PhotoDownload();","//download.js v4.2, by dandavis; 2008-2016. [MIT] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compat way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.\n// v4 adds AMD/UMD, commonJS, and plain browser support\n// v4.1 adds url download capability via solo URL argument (same domain/CORS only)\n// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors\n// https://github.com/rndme/download\n\n(function (root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine([], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node. Does not work with strict CommonJS, but\n\t\t// only CommonJS-like environments that support module.exports,\n\t\t// like Node.\n\t\tmodule.exports = factory();\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.download = factory();\n  }\n}(this, function () {\n\n\treturn function download(data, strFileName, strMimeType) {\n\n\t\tvar self = window, // this script is only for browsers anyway...\n\t\t\tdefaultMime = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\t\tmimeType = strMimeType || defaultMime,\n\t\t\tpayload = data,\n\t\t\turl = !strFileName && !strMimeType && payload,\n\t\t\tanchor = document.createElement(\"a\"),\n\t\t\ttoString = function(a){return String(a);},\n\t\t\tmyBlob = (self.Blob || self.MozBlob || self.WebKitBlob || toString),\n\t\t\tfileName = strFileName || \"download\",\n\t\t\tblob,\n\t\t\treader;\n\t\t\tmyBlob= myBlob.call ? myBlob.bind(self) : Blob ;\n\t  \n\t\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\t\tpayload=[payload, mimeType];\n\t\t\tmimeType=payload[0];\n\t\t\tpayload=payload[1];\n\t\t}\n\n\n\t\tif(url && url.length< 2048){ // if no filename and no mime, assume a url was passed as the only argument\n\t\t\tfileName = url.split(\"/\").pop().split(\"?\")[0];\n\t\t\tanchor.href = url; // assign href prop to temp anchor\n\t\t  \tif(anchor.href.indexOf(url) !== -1){ // if the browser determines that it's a potentially valid url path:\n        \t\tvar ajax=new XMLHttpRequest();\n        \t\tajax.open( \"GET\", url, true);\n        \t\tajax.responseType = 'blob';\n        \t\tajax.onload= function(e){ \n\t\t\t\t  download(e.target.response, fileName, defaultMime);\n\t\t\t\t};\n        \t\tsetTimeout(function(){ ajax.send();}, 0); // allows setting custom ajax headers using the return:\n\t\t\t    return ajax;\n\t\t\t} // end if valid url?\n\t\t} // end if url?\n\n\n\t\t//go ahead and download dataURLs right away\n\t\tif(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(payload)){\n\t\t\n\t\t\tif(payload.length > (1024*1024*1.999) && myBlob !== toString ){\n\t\t\t\tpayload=dataUrlToBlob(payload);\n\t\t\t\tmimeType=payload.type || defaultMime;\n\t\t\t}else{\t\t\t\n\t\t\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\t\t\tnavigator.msSaveBlob(dataUrlToBlob(payload), fileName) :\n\t\t\t\t\tsaver(payload) ; // everyone else can save dataURLs un-processed\n\t\t\t}\n\t\t\t\n\t\t}else{//not data url, is it a string with special needs?\n\t\t\tif(/([\\x80-\\xff])/.test(payload)){\t\t\t  \n\t\t\t\tvar i=0, tempUiArr= new Uint8Array(payload.length), mx=tempUiArr.length;\n\t\t\t\tfor(i;i<mx;++i) tempUiArr[i]= payload.charCodeAt(i);\n\t\t\t \tpayload=new myBlob([tempUiArr], {type: mimeType});\n\t\t\t}\t\t  \n\t\t}\n\t\tblob = payload instanceof myBlob ?\n\t\t\tpayload :\n\t\t\tnew myBlob([payload], {type: mimeType}) ;\n\n\n\t\tfunction dataUrlToBlob(strUrl) {\n\t\t\tvar parts= strUrl.split(/[:;,]/),\n\t\t\ttype= parts[1],\n\t\t\tdecoder= parts[2] == \"base64\" ? atob : decodeURIComponent,\n\t\t\tbinData= decoder( parts.pop() ),\n\t\t\tmx= binData.length,\n\t\t\ti= 0,\n\t\t\tuiArr= new Uint8Array(mx);\n\n\t\t\tfor(i;i<mx;++i) uiArr[i]= binData.charCodeAt(i);\n\n\t\t\treturn new myBlob([uiArr], {type: type});\n\t\t }\n\n\t\tfunction saver(url, winMode){\n\n\t\t\tif ('download' in anchor) { //html5 A[download]\n\t\t\t\tanchor.href = url;\n\t\t\t\tanchor.setAttribute(\"download\", fileName);\n\t\t\t\tanchor.className = \"download-js-link\";\n\t\t\t\tanchor.innerHTML = \"downloading...\";\n\t\t\t\tanchor.style.display = \"none\";\n\t\t\t\tdocument.body.appendChild(anchor);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tanchor.click();\n\t\t\t\t\tdocument.body.removeChild(anchor);\n\t\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(anchor.href);}, 250 );}\n\t\t\t\t}, 66);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// handle non-a[download] safari as best we can:\n\t\t\tif(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent)) {\n\t\t\t\tif(/^data:/.test(url))\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t\tif(!window.open(url)){ // popup blocked, offer direct download:\n\t\t\t\t\tif(confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")){ location.href=url; }\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//do iframe dataURL download (old ch+FF):\n\t\t\tvar f = document.createElement(\"iframe\");\n\t\t\tdocument.body.appendChild(f);\n\n\t\t\tif(!winMode && /^data:/.test(url)){ // force a mime that will download:\n\t\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t}\n\t\t\tf.src=url;\n\t\t\tsetTimeout(function(){ document.body.removeChild(f); }, 333);\n\n\t\t}//end saver\n\n\n\n\n\t\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\t\treturn navigator.msSaveBlob(blob, fileName);\n\t\t}\n\n\t\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\t\tsaver(self.URL.createObjectURL(blob), true);\n\t\t}else{\n\t\t\t// handle non-Blob()+non-URL browsers:\n\t\t\tif(typeof blob === \"string\" || blob.constructor===toString ){\n\t\t\t\ttry{\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t\t}catch(y){\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \",\" + encodeURIComponent(blob)  );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Blob but not URL support:\n\t\t\treader=new FileReader();\n\t\t\treader.onload=function(e){\n\t\t\t\tsaver(this.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(blob);\n\t\t}\n\t\treturn true;\n\t}; /* end download() */\n}));\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL3Bob3RvLWRvd25sb2FkLmpzIiwiYXBwL3NjcmlwdHMvbW9kdWxlcy90ZW1wbGF0ZXMuanMiLCJhcHAvc2NyaXB0cy92ay1waG90by1kb3dubG9hZC5qcyIsIm5vZGVfbW9kdWxlcy9kb3dubG9hZGpzL2Rvd25sb2FkLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7OztBQ0FBOztBQUNBOzs7Ozs7Ozs7O0lBRXFCLGE7OztBQUNqQiwyQkFBeUI7QUFBQSxRQUFiLE1BQWEsdUVBQUosRUFBSTs7QUFBQTs7QUFDckI7QUFDQTtBQUNBLFNBQUssZUFBTCxHQUF1QixVQUF2QjtBQUVBLFNBQUssU0FBTCxHQUFpQjtBQUNiO0FBQ0EsTUFBQSxnQkFBZ0IsRUFBRSxlQUZMO0FBR2I7QUFDQTtBQUNBLE1BQUEsa0JBQWtCLEVBQUUsZUFMUDtBQU1iO0FBQ0EsTUFBQSxRQUFRLEVBQUU7QUFQRyxLQUFqQjtBQVVBLFNBQUssUUFBTCxHQUFnQixJQUFJLGtCQUFKLENBQTJCO0FBQ3ZDLE1BQUEsU0FBUyxFQUFFLEtBQUs7QUFEdUIsS0FBM0IsQ0FBaEIsQ0FmcUIsQ0FtQnJCOztBQUNBLFNBQUssUUFBTCxHQUFnQjtBQUNaLE1BQUEsU0FBUyxFQUFFLENBQ1A7QUFDQTtBQUNJLFFBQUEsSUFBSSxFQUFFLElBRFY7QUFFSSxRQUFBLFFBQVEsRUFBRSxLQUFLLGVBRm5CO0FBR0ksUUFBQSxPQUFPLEVBQUUsS0FBSyxVQUhsQjtBQUlJLFFBQUEsS0FBSyxFQUFFO0FBSlgsT0FGTyxFQVFQO0FBQ0ksUUFBQSxJQUFJLEVBQUUsT0FEVjtBQUVJLFFBQUEsUUFBUSxFQUFFLG1CQUZkO0FBR0ksUUFBQSxPQUFPLEVBQUUsS0FBSyxVQUhsQjtBQUlJLFFBQUEsS0FBSyxFQUFFO0FBSlgsT0FSTyxDQURDLENBZVQ7O0FBZlMsS0FBaEI7QUFrQkEsU0FB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QUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiaW1wb3J0IERvd25sb2FkIGZyb20gJ2Rvd25sb2FkanMnO1xyXG5pbXBvcnQgUGhvdG9Eb3dubG9hZFRlbXBsYXRlcyBmcm9tICcuL3RlbXBsYXRlcyc7XHJcblxyXG5leHBvcnQgZGVmYXVsdCBjbGFzcyBQaG90b0Rvd25sb2FkIHtcclxuICAgIGNvbnN0cnVjdG9yKHBhcmFtcyA9IHt9KSB7XHJcbiAgICAgICAgLy8g0KHRgdGL0LvQutCwLCDQsiDQutC+0YLQvtGA0YPRjiDQvtCx0LXRgNC90YPRgtCwINC60LDRgNGC0LjQvdC60LAsIFxyXG4gICAgICAgIC8vINC30LTQtdGB0Ywg0L3Rg9C20L3QsiDQtNC70Y8g0YLRgNC40LPQs9C10YDQsCDRgdC+0LfQtNCw0L3QuNGPL9C+0LHQvdC+0LLQu9C10L3QuNGPINC60L3QvtC/0LrQuFxyXG4gICAgICAgIHRoaXMuaW1nQ29udGFpbmVyX2lkID0gJ3B2X3Bob3RvJztcclxuXHJcbiAgICAgICAgdGhpcy5zZWxlY3RvcnMgPSB7XHJcbiAgICAgICAgICAgIC8vIGlkINC60L7QvdGC0LXQudC90LXRgNCwINC60L3QvtC/0LrQuFxyXG4gICAgICAgICAgICBwaG90b0Rvd25sb2FkX2lkOiAnUGhvdG9Eb3dubG9hZCcsXHJcbiAgICAgICAgICAgIC8vINCa0L7QvdGC0LXQudC90LXRgCwg0LIg0LrQvtGC0L7RgNC+0Lwg0L3QsNGF0L7QtNC40YLRgdGPINC60LDRgNGC0LjQvdC60LAg0Lgg0Y3Qu9C10LzQtdC90YLRiyDRg9C/0YDQsNCy0LvQtdC90LjRjyxcclxuICAgICAgICAgICAgLy8g0YHQvtC30LTQsNCy0LDRgtGMINC60L3QvtC/0LrRgyDQsdGD0LTQtdC8INCyINC90LXQvFxyXG4gICAgICAgICAgICBpbWdDb250YWluZXJfY2xhc3M6ICdwdl9pbWFnZV93cmFwJyxcclxuICAgICAgICAgICAgLy8gaWQsINC60L7RgtC+0YDRi9C5INC00L7QsdCw0LLQuNGC0YHRjyDRgtC10LPRgyBzdHlsZVxyXG4gICAgICAgICAgICBzdHlsZV9pZDogJ1Bob3RvRG93bmxvYWRTdHlsZScsXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgdGhpcy50ZW1wbGF0ZSA9IG5ldyBQaG90b0Rvd25sb2FkVGVtcGxhdGVzKHtcclxuICAgICAgICAgICAgc2VsZWN0b3JzOiB0aGlzLnNlbGVjdG9yc1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICAvLyDQntCx0YrQtdC60YIg0YEg0L7Qv9C40YHQsNC90LjQtdC8INC+0LHRgNCw0LHQvtGC0YfQuNC60L7QslxyXG4gICAgICAgIHRoaXMudHJpZ2dlcnMgPSB7XHJcbiAgICAgICAgICAgIG1vdXNlb3ZlcjogW1xyXG4gICAgICAgICAgICAgICAgLy8g0KHQtdC70LXQutGC0L7RgCDRgdGB0YvQu9C60LgsINCyINC60L7RgtC+0YDRg9GOINC+0LHQtdGA0L3Rg9GC0LAg0LrQsNGA0YLQuNC90LrQsCDQsiDQv9GA0L7RgdC80L7RgtGA0YnQuNC60LVcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnaWQnLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiB0aGlzLmltZ0NvbnRhaW5lcl9pZCxcclxuICAgICAgICAgICAgICAgICAgICBoYW5kbGVyOiB0aGlzLl91cGRhdGVCdG4sXHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgICAgIHR5cGU6ICdjbGFzcycsXHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZWN0b3I6ICdQaG90b0Rvd25sb2FkX2J0bicsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogdGhpcy5fdXBkYXRlQnRuLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgXSwgLy8g0JrQvtC90LXRhiBtb3VzZW92ZXJcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB0aGlzLmxhc3RfaW1hZ2VfZGF0YSA9IHtcclxuICAgICAgICAgICAgc3JjOiBudWxsLFxyXG4gICAgICAgICAgICB3aWR0aDogbnVsbCxcclxuICAgICAgICAgICAgaGVpZ2h0OiBudWxsLFxyXG4gICAgICAgIH07XHJcblxyXG5cclxuICAgICAgICAvLyDQotC+0YfQutCwINCy0YXQvtC00LBcclxuICAgICAgICB0aGlzLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICBfdXBkYXRlQnRuKGVsZW0pIHtcclxuICAgICAgICBsZXQgcGFyZW50ID0gZWxlbS5jbG9zZXN0KCcuJyArIHRoaXMuc2VsZWN0b3JzLmltZ0NvbnRhaW5lcl9jbGFzcyk7XHJcblxyXG4gICAgICAgIC8vINCV0YHQu9C4INCyINGA0L7QtNC40YLQtdC70YzRgdC60L7QvCDQutC+0L3RgtC10LnQvdC10YDQtSDQtdGJ0LUg0L3QtdGCINC60L3QvtC/0LrQuFxyXG4gICAgICAgIGlmICghcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJyMnICsgdGhpcy5zZWxlY3RvcnMucGhvdG9Eb3dubG9hZF9pZCkpIHtcclxuICAgICAgICAgICAgLy8g0YLQviDRgdC+0LfQtNCw0LTQuNC8INC10LVcclxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRG93bmxvYWRDb250YWluZXIoZWxlbSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYnRuID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5QaG90b0Rvd25sb2FkX2J0bicpO1xyXG4gICAgICAgIGxldCBzaXplID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5QaG90b0Rvd25sb2FkX3NpemUnKTtcclxuICAgICAgICB0aGlzLmxhc3RfaW1hZ2VfZGF0YSA9IHdpbmRvdy5QaG90b3ZpZXcuZ2VuRGF0YShjdXIucHZDdXJQaG90byk7XHJcblxyXG4gICAgICAgIC8vINCV0YHQu9C4INGB0YHRi9C70LrQsCDQsiDQutC90L7Qv9C60LUg0L3QtSDRgtCwLCDQutC+0YLQvtGA0LDRjyDQvdGD0LbQvdCwINGB0LXQudGH0LDRgVxyXG4gICAgICAgIGlmIChidG4uaHJlZiAhPT0gdGhpcy5sYXN0X2ltYWdlX2RhdGEuc3JjKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdidG4uaHJlZiAhPT0gdGhpcy5sYXN0X2ltYWdlX2RhdGEuc3JjJyk7XHJcblxyXG4gICAgICAgICAgICBidG4uaHJlZiA9IHRoaXMubGFzdF9pbWFnZV9kYXRhLnNyYztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RfaW1hZ2VfZGF0YS53aWR0aCAmJiB0aGlzLmxhc3RfaW1hZ2VfZGF0YS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHNpemUuY2xhc3NMaXN0LnJlbW92ZSgnbm9uX3NpemUnKTtcclxuICAgICAgICAgICAgICAgIHNpemUudGV4dENvbnRlbnQgPSBgJHt0aGlzLmxhc3RfaW1hZ2VfZGF0YS53aWR0aH14JHt0aGlzLmxhc3RfaW1hZ2VfZGF0YS5oZWlnaHR9YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNpemUuY2xhc3NMaXN0LmFkZCgnbm9uX3NpemUnKTtcclxuICAgICAgICAgICAgICAgIHNpemUudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlRG93bmxvYWRDb250YWluZXIoZWxlbSkge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSBlbGVtLmNsb3Nlc3QoJy4nICsgdGhpcy5zZWxlY3RvcnMuaW1nQ29udGFpbmVyX2NsYXNzKTtcclxuICAgICAgICBsZXQgd3JhcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpO1xyXG4gICAgICAgIHdyYXAuaWQgPSB0aGlzLnNlbGVjdG9ycy5waG90b0Rvd25sb2FkX2lkO1xyXG5cclxuICAgICAgICB3cmFwLmlubmVySFRNTCA9IHRoaXMudGVtcGxhdGUuZ2V0SW5uZXJFbGVtcygpO1xyXG5cclxuICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgd3JhcC5jbGFzc0xpc3QuYWRkKCdyZWFkeScpO1xyXG4gICAgICAgIH0sIDApO1xyXG5cclxuICAgICAgICBwYXJlbnQuYXBwZW5kQ2hpbGQod3JhcCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrQ29tcGxpYW5jZUNoaWxkKHRhcmdldCwgdHJpZ2dlcikge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSAodHJpZ2dlci50eXBlID09PSAnaWQnKSA/XHJcbiAgICAgICAgICAgIHRhcmdldC5jbG9zZXN0KCcjJyArIHRyaWdnZXIuc2VsZWN0b3IpIDpcclxuICAgICAgICAgICAgdGFyZ2V0LmNsb3Nlc3QoJy4nICsgdHJpZ2dlci5zZWxlY3Rvcik7XHJcblxyXG4gICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2hlY2tDb21wbGlhbmNlVGFyZ2V0KHBhcmVudCwgdHJpZ2dlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0NvbXBsaWFuY2VUYXJnZXQodGFyZ2V0LCB0cmlnZ2VyKSB7XHJcbiAgICAgICAgbGV0IGNvbXBsaWFuY2UgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8g0JTQstCwINC+0YLQtNC10LvRjNC90YvRhSDRg9GB0LvQvtCy0LjRjyDQtNC70Y8g0YLQvtCz0L4sINGH0YLQvtCx0Ysg0LHRi9C70LAg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQvdCw0LfQvdCw0YfQuNGC0YxcclxuICAgICAgICAvLyDRgNCw0LfQvdGL0LUg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDQv9C+IGlkINC4INC/0L4g0LrQu9Cw0YHRgdGDINC90LAg0L7QtNC40L0g0Y3Qu9C10LzQtdC90YIsINC4INC+0L3QuCDRgdGA0LDQsdC+0YLQsNC70Lgg0L7QsdCwXHJcbiAgICAgICAgaWYgKHRyaWdnZXIudHlwZSA9PT0gJ2lkJykge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSB0cmlnZ2VyLnNlbGVjdG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wbGlhbmNlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHJpZ2dlci5oYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJz4gJyArIHRyaWdnZXIuc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXIuaGFuZGxlci5jYWxsKHRoaXMsIHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0cmlnZ2VyLnR5cGUgPT09ICdjbGFzcycpIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnModHJpZ2dlci5zZWxlY3RvcikpIHtcclxuICAgICAgICAgICAgICAgIGNvbXBsaWFuY2UgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyLmhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnPiAnICsgdHJpZ2dlci5zZWxlY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlci5oYW5kbGVyLmNhbGwodGhpcywgdGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbXBsaWFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g0JzQtdGC0L7QtCwg0LrQvtGC0L7RgNGL0Lkg0LLRi9C30YvQstCw0LXRgiDQvdGD0LbQvdGL0Lkg0L7QsdGA0LDQsdC+0YLRh9C40Log0L/RgNC4INC90YPQttC90L7QvCDRgdC+0LHRi9GC0LjQuFxyXG4gICAgX3dhdGNoVHJpZ2dlcihldmVudCkge1xyXG4gICAgICAgIC8vINCh0LzQvtGC0YDQuNC8LCDQtdGB0YLRjCDQu9C4INC+0LHRgNCw0LHQvtGC0YfQuNC60Lgg0L/QvtC70YPRh9C10L3QvdC+0LPQviDRgtC40L/QsCDRgdC+0LHRi9GC0LjRj1xyXG4gICAgICAgIC8vINCd0LAg0YHQsNC80L7QvCDQtNC10LvQtSDQvtC90Lgg0LLRgdC10LPQtNCwINC00L7Qu9C20L3RiyDQsdGL0YLRjCwg0L3QviDQstGB0LUg0LbQtVxyXG4gICAgICAgIGxldCB0cmlnZ2VycyA9IHRoaXMudHJpZ2dlcnNbZXZlbnQudHlwZV07XHJcbiAgICAgICAgaWYgKHRyaWdnZXJzID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgLy8g0JHQtdGA0LXQvCDRjdC70LXQvNC10L3Rgiwg0L3QsCDQutC+0YLQvtGA0L7QvCDRgdGA0LDQsdC+0YLQsNC70L4g0YHQvtCx0YvRgtC40LVcclxuICAgICAgICBsZXQgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG5cclxuICAgICAgICAvLyDQptC40LrQuyDQv9C+INC+0LHRitC10LrRgtGDINC+0LHRgNCw0LHQvtGC0YfQuNC60L7QsiDQv9C+0LvRg9GH0LXQvdC90L7Qs9C+INGC0LjQv9CwINGB0L7QsdGL0YLQuNGPXHJcbiAgICAgICAgdHJpZ2dlcnMuZm9yRWFjaCh0cmlnZ2VyID0+IHtcclxuICAgICAgICAgICAgLy8g0JXRgdC70Lgg0YbQtdC70Lgg0YHQvtCx0YvRgtC40Y8g0L3QtdGCINCyINC+0LHRitC10LrRgtC1INC+0LHRgNCw0LHQvtGC0YfQuNC60L7Qsiwg0L3QviDQsiDQvtCx0YDQsNCx0L7RgtGH0LjQutC1INGD0LrQsNC30LDQvdC+LCBcclxuICAgICAgICAgICAgLy8g0YfRgtC+INC+0L0g0LzQvtC20LXRgiDRgdGA0LDQsdCw0YLRi9Cy0LDRgtGMINC90LAg0LTQvtGH0LXRgNC90LXQvCDRjdC70LXQvNC10L3RgtC1XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2hlY2tDb21wbGlhbmNlVGFyZ2V0KHRhcmdldCwgdHJpZ2dlcikgJiYgdHJpZ2dlci5jaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgLy8g0J/QvtC/0YDQvtCx0YPQtdC8INC90LDQudGC0Lgg0YDQvtC00LjRgtC10LvRjNGB0LrQuNC5INGN0LvQtdC80LXQvdGCINGG0LXQu9C4LCDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0YHQtdC70LXQutGC0L7RgNGDXHJcbiAgICAgICAgICAgICAgICAvLyDQuNC3INC+0LHRitC10LrRgtCwINC+0LHRgNCw0LHQvtGC0YfQuNC60L7QslxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tDb21wbGlhbmNlQ2hpbGQodGFyZ2V0LCB0cmlnZ2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINCj0YHRgtCw0L3QvtCy0LrQsCDQvdCwIGRvY3VtZW50INGB0LvRg9GI0LDRgtC10LvQtdC5INGC0LjQv9C+0LIg0YHQvtCx0YvRgtC40LksINC40LzQtdGO0YnQuNGF0YHRjyDQsiDQvtCx0YrQtdC60YLQtSDQvtCx0YDQsNCx0L7RgtGH0LjQutC+0LJcclxuICAgIF9pbml0V2F0Y2hlcigpIHtcclxuICAgICAgICBsZXQgdHlwZXMgPSBPYmplY3Qua2V5cyh0aGlzLnRyaWdnZXJzKTtcclxuICAgICAgICB0eXBlcy5mb3JFYWNoKHR5cGUgPT4gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCB0aGlzLl93YXRjaFRyaWdnZXIuYmluZCh0aGlzKSkpXHJcbiAgICB9XHJcblxyXG4gICAgLy8g0JzQtdGC0L7QtCDQtNC+0LHQsNCy0LvQtdC90LjRjyDQvdCwINGB0YLRgNCw0L3QuNGG0YMg0YHRgtC40LvQtdC5LCDQvdC10L7QsdGF0L7QtNC40LzRi9GFINC00LvRjyDRgNCw0LHQvtGC0YsgUGhvdG9Eb3dubG9hZFxyXG4gICAgX2luamVjdENTUygpIHtcclxuICAgICAgICBsZXQgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xyXG4gICAgICAgIHN0eWxlLmlkID0gdGhpcy5zZWxlY3RvcnMuc3R5bGVfaWQ7XHJcbiAgICAgICAgc3R5bGUudGV4dENvbnRlbnQgPSB0aGlzLnRlbXBsYXRlLmdldFN0eWxlQ29udGVudCgpO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8g0KLQvtGH0LrQsCDQstGF0L7QtNCwXHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCclYyVzJywgKHdpbmRvdy5sb2dfY29sb3IpID8gd2luZG93LmxvZ19jb2xvci5ibHVlIDogJycsICdQaG90b0Rvd25sb2FkOiBJbml0Jyk7XHJcblxyXG4gICAgICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4IFBob3RvRG93bmxvYWRcclxuICAgICAgICB0aGlzLl9pbmplY3RDU1MoKTtcclxuXHJcbiAgICAgICAgLy8g0JjQvdC40YbQuNCw0LvQuNC30LjRgNGD0LXQvCDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5XHJcbiAgICAgICAgdGhpcy5faW5pdFdhdGNoZXIoKTtcclxuICAgIH1cclxufSIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIFBob3RvRG93bmxvYWRUZW1wbGF0ZXMge1xyXG4gICAgY29uc3RydWN0b3IocGFyYW1zID0ge30pIHtcclxuICAgICAgICAgICAgdGhpcy5zZWxlY3RvcnMgPSBwYXJhbXMuc2VsZWN0b3JzO1xyXG5cclxuICAgICAgICAgICAgLy8g0J7QsdGK0LXQutGCLCDQs9C10L3QtdGA0LjRgNGD0Y7RidC40Lkg0YDQsNC30L3QvtGG0LLQtdGC0L3Ri9C1INC40LrQvtC90LrQuFxyXG4gICAgICAgICAgICB0aGlzLmljb25zID0ge1xyXG4gICAgICAgICAgICAgICAgX2NvbG9yczoge1xyXG4gICAgICAgICAgICAgICAgICAgIGdyZWVuOiAnIzAwQjc1QScsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVkOiAnI0Y5MjY3MicsXHJcbiAgICAgICAgICAgICAgICAgICAgd2hpdGU6ICcjRkZGRkZGJyxcclxuICAgICAgICAgICAgICAgICAgICB5ZWxsb3c6ICcjRkZDMDAwJyxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBfcHJlZml4OiAnZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLTgsJyxcclxuICAgICAgICAgICAgICAgIC8qIGh0bWwgKi9cclxuICAgICAgICAgICAgICAgIF90ZW1wbGF0ZTogYDxzdmcgeG1sbnM9XCJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Z1wiIHdpZHRoPVwiMTZcIiBoZWlnaHQ9XCIxNlwiIHZlcnNpb249XCIxLjFcIiB2aWV3Qm94PVwiMCAwIDE2IDE2XCI+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8cGF0aCBmaWxsPVwie3tjb2xvcn19XCIgZD1cIk0gNCwwIDQsOCAwLDggOCwxNiAxNiw4IDEyLDggMTIsMCA0LDAgelwiLz5cclxuICAgICAgICAgICAgICAgICAgICAgICAgPC9zdmc+YCxcclxuICAgICAgICAgICAgICAgIF90ZW1wOiBmdW5jdGlvbihjb2xvcikge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl90ZW1wbGF0ZS5yZXBsYWNlKC9cXHtcXHsuKlxcfVxcfS9nbSwgY29sb3IgPyBjb2xvciA6ICd3aGl0ZScpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGdldChjb2xvciwgdXJsID0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBfY29sb3IgPSB0aGlzLl9jb2xvcnNbY29sb3JdID8gdGhpcy5fY29sb3JzW2NvbG9yXSA6IGNvbG9yO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdmcgPSB0aGlzLl90ZW1wKF9jb2xvcikucmVwbGFjZSgvW1xcc117Mix9L2dtLCAnICcpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiB1cmwgPyB0aGlzLl9wcmVmaXggKyBlbmNvZGVVUklDb21wb25lbnQoc3ZnKSA6IHN2ZztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9IC8vIGNvbnN0cnVjdG9yXHJcblxyXG4gICAgZ2V0SW5uZXJFbGVtcygpIHtcclxuICAgICAgICByZXR1cm4gLyogaHRtbCAqLyBgXHJcbiAgICAgICAgICAgIDxhIGNsYXNzPVwiUGhvdG9Eb3dubG9hZF9idG5cIiBocmVmPVwiIyFcIiB0YXJnZXQ9XCJfYmxhbmtcIiBkcmFnZ2FibGU9XCJmYWxzZVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIlBob3RvRG93bmxvYWRfaWNvblwiPjwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIlBob3RvRG93bmxvYWRfc2l6ZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgYDtcclxuICAgIH1cclxuXHJcbiAgICBnZXRTdHlsZUNvbnRlbnQoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiAvKiBjc3MgKi8gYFxyXG4gICAgICAgICMke3RoaXMuc2VsZWN0b3JzLnBob3RvRG93bmxvYWRfaWR9IHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZC1jb2xvcjogIzAwMDtcclxuICAgICAgICAgICAgYm9yZGVyLXRvcC1sZWZ0LXJhZGl1czogNHB4O1xyXG4gICAgICAgICAgICBwb3NpdGlvbjogYWJzb2x1dGU7XHJcbiAgICAgICAgICAgIGJvdHRvbTogMDtcclxuICAgICAgICAgICAgbGVmdDogMTAwJTtcclxuICAgICAgICAgICAgb3BhY2l0eTogMDtcclxuICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgtMzhweCwgMCwgMXB4KTtcclxuICAgICAgICAgICAgd2lsbC1jaGFuZ2U6IHRyYW5zZm9ybSwgb3BhY2l0eTtcclxuICAgICAgICAgICAgdHJhbnNpdGlvbjogb3BhY2l0eSAuMjVzIGVhc2UtaW4tb3V0LCB0cmFuc2Zvcm0gLjI1cyBlYXNlLWluLW91dCAhaW1wb3J0YW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuJHt0aGlzLnNlbGVjdG9ycy5pbWdDb250YWluZXJfY2xhc3N9OmhvdmVyICMke3RoaXMuc2VsZWN0b3JzLnBob3RvRG93bmxvYWRfaWR9LnJlYWR5IHtcclxuICAgICAgICAgICAgb3BhY2l0eTogLjM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC4ke3RoaXMuc2VsZWN0b3JzLmltZ0NvbnRhaW5lcl9jbGFzc30gIyR7dGhpcy5zZWxlY3RvcnMucGhvdG9Eb3dubG9hZF9pZH0ucmVhZHk6aG92ZXIge1xyXG4gICAgICAgICAgICBvcGFjaXR5OiAuODtcclxuICAgICAgICAgICAgdHJhbnNmb3JtOiB0cmFuc2xhdGUzZCgtMTAwJSwgMCwgMXB4KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLlBob3RvRG93bmxvYWRfYnRuIHtcclxuICAgICAgICAgICAgZGlzcGxheTogZmxleDtcclxuICAgICAgICAgICAgYWxpZ24taXRlbXM6IGNlbnRlcjtcclxuICAgICAgICAgICAgcGFkZGluZzogMTBweDtcclxuICAgICAgICB9XHJcbiAgICAgICAgLlBob3RvRG93bmxvYWRfYnRuOmhvdmVyIHtcclxuICAgICAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lO1xyXG4gICAgICAgIH1cclxuICAgICAgICAuUGhvdG9Eb3dubG9hZF9pY29uIHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCcke3RoaXMuaWNvbnMuZ2V0KCd3aGl0ZScpfScpO1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kLXNpemU6IGNvbnRhaW47XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQtcmVwZWF0OiBuby1yZXBlYXQ7XHJcbiAgICAgICAgICAgIGhlaWdodDogMThweDtcclxuICAgICAgICAgICAgd2lkdGg6IDE4cHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5QaG90b0Rvd25sb2FkX2J0bjpob3ZlciAuUGhvdG9Eb3dubG9hZF9pY29uIHtcclxuICAgICAgICAgICAgYmFja2dyb3VuZC1pbWFnZTogdXJsKCcke3RoaXMuaWNvbnMuZ2V0KCdncmVlbicpfScpO1xyXG4gICAgICAgIH1cclxuICAgICAgICAjJHt0aGlzLnNlbGVjdG9ycy5waG90b0Rvd25sb2FkX2lkfSAuUGhvdG9Eb3dubG9hZF9zaXplOm5vdCgubm9uX3NpemUpIHtcclxuICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xyXG4gICAgICAgICAgICBjb2xvcjogI0MzQ0ZFMCAhaW1wb3J0YW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBgO1xyXG4gICAgICAgIH0gLy8gZ2V0U3R5bGVDb250ZW50XHJcblxyXG59IiwiaW1wb3J0IFBob3RvRG93bmxvYWQgZnJvbSAnLi9tb2R1bGVzL3Bob3RvLWRvd25sb2FkJztcclxuXHJcblxyXG53aW5kb3cucGhvdG9Eb3dubG9hZCA9IG5ldyBQaG90b0Rvd25sb2FkKCk7IiwiLy9kb3dubG9hZC5qcyB2NC4yLCBieSBkYW5kYXZpczsgMjAwOC0yMDE2LiBbTUlUXSBzZWUgaHR0cDovL2Rhbm1sLmNvbS9kb3dubG9hZC5odG1sIGZvciB0ZXN0cy91c2FnZVxuLy8gdjEgbGFuZGVkIGEgRkYrQ2hyb21lIGNvbXBhdCB3YXkgb2YgZG93bmxvYWRpbmcgc3RyaW5ncyB0byBsb2NhbCB1bi1uYW1lZCBmaWxlcywgdXBncmFkZWQgdG8gdXNlIGEgaGlkZGVuIGZyYW1lIGFuZCBvcHRpb25hbCBtaW1lXG4vLyB2MiBhZGRlZCBuYW1lZCBmaWxlcyB2aWEgYVtkb3dubG9hZF0sIG1zU2F2ZUJsb2IsIElFICgxMCspIHN1cHBvcnQsIGFuZCB3aW5kb3cuVVJMIHN1cHBvcnQgZm9yIGxhcmdlcitmYXN0ZXIgc2F2ZXMgdGhhbiBkYXRhVVJMc1xuLy8gdjMgYWRkZWQgZGF0YVVSTCBhbmQgQmxvYiBJbnB1dCwgYmluZC10b2dnbGUgYXJpdHksIGFuZCBsZWdhY3kgZGF0YVVSTCBmYWxsYmFjayB3YXMgaW1wcm92ZWQgd2l0aCBmb3JjZS1kb3dubG9hZCBtaW1lIGFuZCBiYXNlNjQgc3VwcG9ydC4gMy4xIGltcHJvdmVkIHNhZmFyaSBoYW5kbGluZy5cbi8vIHY0IGFkZHMgQU1EL1VNRCwgY29tbW9uSlMsIGFuZCBwbGFpbiBicm93c2VyIHN1cHBvcnRcbi8vIHY0LjEgYWRkcyB1cmwgZG93bmxvYWQgY2FwYWJpbGl0eSB2aWEgc29sbyBVUkwgYXJndW1lbnQgKHNhbWUgZG9tYWluL0NPUlMgb25seSlcbi8vIHY0LjIgYWRkcyBzZW1hbnRpYyB2YXJpYWJsZSBuYW1lcywgbG9uZyAob3ZlciAyTUIpIGRhdGFVUkwgc3VwcG9ydCwgYW5kIGhpZGRlbiBieSBkZWZhdWx0IHRlbXAgYW5jaG9yc1xuLy8gaHR0cHM6Ly9naXRodWIuY29tL3JuZG1lL2Rvd25sb2FkXG5cbihmdW5jdGlvbiAocm9vdCwgZmFjdG9yeSkge1xuXHRpZiAodHlwZW9mIGRlZmluZSA9PT0gJ2Z1bmN0aW9uJyAmJiBkZWZpbmUuYW1kKSB7XG5cdFx0Ly8gQU1ELiBSZWdpc3RlciBhcyBhbiBhbm9ueW1vdXMgbW9kdWxlLlxuXHRcdGRlZmluZShbXSwgZmFjdG9yeSk7XG5cdH0gZWxzZSBpZiAodHlwZW9mIGV4cG9ydHMgPT09ICdvYmplY3QnKSB7XG5cdFx0Ly8gTm9kZS4gRG9lcyBub3Qgd29yayB3aXRoIHN0cmljdCBDb21tb25KUywgYnV0XG5cdFx0Ly8gb25seSBDb21tb25KUy1saWtlIGVudmlyb25tZW50cyB0aGF0IHN1cHBvcnQgbW9kdWxlLmV4cG9ydHMsXG5cdFx0Ly8gbGlrZSBOb2RlLlxuXHRcdG1vZHVsZS5leHBvcnRzID0gZmFjdG9yeSgpO1xuXHR9IGVsc2Uge1xuXHRcdC8vIEJyb3dzZXIgZ2xvYmFscyAocm9vdCBpcyB3aW5kb3cpXG5cdFx0cm9vdC5kb3dubG9hZCA9IGZhY3RvcnkoKTtcbiAgfVxufSh0aGlzLCBmdW5jdGlvbiAoKSB7XG5cblx0cmV0dXJuIGZ1bmN0aW9uIGRvd25sb2FkKGRhdGEsIHN0ckZpbGVOYW1lLCBzdHJNaW1lVHlwZSkge1xuXG5cdFx0dmFyIHNlbGYgPSB3aW5kb3csIC8vIHRoaXMgc2NyaXB0IGlzIG9ubHkgZm9yIGJyb3dzZXJzIGFueXdheS4uLlxuXHRcdFx0ZGVmYXVsdE1pbWUgPSBcImFwcGxpY2F0aW9uL29jdGV0LXN0cmVhbVwiLCAvLyB0aGlzIGRlZmF1bHQgbWltZSBhbHNvIHRyaWdnZXJzIGlmcmFtZSBkb3dubG9hZHNcblx0XHRcdG1pbWVUeXBlID0gc3RyTWltZVR5cGUgfHwgZGVmYXVsdE1pbWUsXG5cdFx0XHRwYXlsb2FkID0gZGF0YSxcblx0XHRcdHVybCA9ICFzdHJGaWxlTmFtZSAmJiAhc3RyTWltZVR5cGUgJiYgcGF5bG9hZCxcblx0XHRcdGFuY2hvciA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJhXCIpLFxuXHRcdFx0dG9TdHJpbmcgPSBmdW5jdGlvbihhKXtyZXR1cm4gU3RyaW5nKGEpO30sXG5cdFx0XHRteUJsb2IgPSAoc2VsZi5CbG9iIHx8IHNlbGYuTW96QmxvYiB8fCBzZWxmLldlYktpdEJsb2IgfHwgdG9TdHJpbmcpLFxuXHRcdFx0ZmlsZU5hbWUgPSBzdHJGaWxlTmFtZSB8fCBcImRvd25sb2FkXCIsXG5cdFx0XHRibG9iLFxuXHRcdFx0cmVhZGVyO1xuXHRcdFx0bXlCbG9iPSBteUJsb2IuY2FsbCA/IG15QmxvYi5iaW5kKHNlbGYpIDogQmxvYiA7XG5cdCAgXG5cdFx0aWYoU3RyaW5nKHRoaXMpPT09XCJ0cnVlXCIpeyAvL3JldmVyc2UgYXJndW1lbnRzLCBhbGxvd2luZyBkb3dubG9hZC5iaW5kKHRydWUsIFwidGV4dC94bWxcIiwgXCJleHBvcnQueG1sXCIpIHRvIGFjdCBhcyBhIGNhbGxiYWNrXG5cdFx0XHRwYXlsb2FkPVtwYXlsb2FkLCBtaW1lVHlwZV07XG5cdFx0XHRtaW1lVHlwZT1wYXlsb2FkWzBdO1xuXHRcdFx0cGF5bG9hZD1wYXlsb2FkWzFdO1xuXHRcdH1cblxuXG5cdFx0aWYodXJsICYmIHVybC5sZW5ndGg8IDIwNDgpeyAvLyBpZiBubyBmaWxlbmFtZSBhbmQgbm8gbWltZSwgYXNzdW1lIGEgdXJsIHdhcyBwYXNzZWQgYXMgdGhlIG9ubHkgYXJndW1lbnRcblx0XHRcdGZpbGVOYW1lID0gdXJsLnNwbGl0KFwiL1wiKS5wb3AoKS5zcGxpdChcIj9cIilbMF07XG5cdFx0XHRhbmNob3IuaHJlZiA9IHVybDsgLy8gYXNzaWduIGhyZWYgcHJvcCB0byB0ZW1wIGFuY2hvclxuXHRcdCAgXHRpZihhbmNob3IuaHJlZi5pbmRleE9mKHVybCkgIT09IC0xKXsgLy8gaWYgdGhlIGJyb3dzZXIgZGV0ZXJtaW5lcyB0aGF0IGl0J3MgYSBwb3RlbnRpYWxseSB2YWxpZCB1cmwgcGF0aDpcbiAgICAgICAgXHRcdHZhciBhamF4PW5ldyBYTUxIdHRwUmVxdWVzdCgpO1xuICAgICAgICBcdFx0YWpheC5vcGVuKCBcIkdFVFwiLCB1cmwsIHRydWUpO1xuICAgICAgICBcdFx0YWpheC5yZXNwb25zZVR5cGUgPSAnYmxvYic7XG4gICAgICAgIFx0XHRhamF4Lm9ubG9hZD0gZnVuY3Rpb24oZSl7IFxuXHRcdFx0XHQgIGRvd25sb2FkKGUudGFyZ2V0LnJlc3BvbnNlLCBmaWxlTmFtZSwgZGVmYXVsdE1pbWUpO1xuXHRcdFx0XHR9O1xuICAgICAgICBcdFx0c2V0VGltZW91dChmdW5jdGlvbigpeyBhamF4LnNlbmQoKTt9LCAwKTsgLy8gYWxsb3dzIHNldHRpbmcgY3VzdG9tIGFqYXggaGVhZGVycyB1c2luZyB0aGUgcmV0dXJuOlxuXHRcdFx0ICAgIHJldHVybiBhamF4O1xuXHRcdFx0fSAvLyBlbmQgaWYgdmFsaWQgdXJsP1xuXHRcdH0gLy8gZW5kIGlmIHVybD9cblxuXG5cdFx0Ly9nbyBhaGVhZCBhbmQgZG93bmxvYWQgZGF0YVVSTHMgcmlnaHQgYXdheVxuXHRcdGlmKC9eZGF0YTooW1xcdystXStcXC9bXFx3Ky4tXSspP1ssO10vLnRlc3QocGF5bG9hZCkpe1xuXHRcdFxuXHRcdFx0aWYocGF5bG9hZC5sZW5ndGggPiAoMTAyNCoxMDI0KjEuOTk5KSAmJiBteUJsb2IgIT09IHRvU3RyaW5nICl7XG5cdFx0XHRcdHBheWxvYWQ9ZGF0YVVybFRvQmxvYihwYXlsb2FkKTtcblx0XHRcdFx0bWltZVR5cGU9cGF5bG9hZC50eXBlIHx8IGRlZmF1bHRNaW1lO1xuXHRcdFx0fWVsc2V7XHRcdFx0XG5cdFx0XHRcdHJldHVybiBuYXZpZ2F0b3IubXNTYXZlQmxvYiA/ICAvLyBJRTEwIGNhbid0IGRvIGFbZG93bmxvYWRdLCBvbmx5IEJsb2JzOlxuXHRcdFx0XHRcdG5hdmlnYXRvci5tc1NhdmVCbG9iKGRhdGFVcmxUb0Jsb2IocGF5bG9hZCksIGZpbGVOYW1lKSA6XG5cdFx0XHRcdFx0c2F2ZXIocGF5bG9hZCkgOyAvLyBldmVyeW9uZSBlbHNlIGNhbiBzYXZlIGRhdGFVUkxzIHVuLXByb2Nlc3NlZFxuXHRcdFx0fVxuXHRcdFx0XG5cdFx0fWVsc2V7Ly9ub3QgZGF0YSB1cmwsIGlzIGl0IGEgc3RyaW5nIHdpdGggc3BlY2lhbCBuZWVkcz9cblx0XHRcdGlmKC8oW1xceDgwLVxceGZmXSkvLnRlc3QocGF5bG9hZCkpe1x0XHRcdCAgXG5cdFx0XHRcdHZhciBpPTAsIHRlbXBVaUFycj0gbmV3IFVpbnQ4QXJyYXkocGF5bG9hZC5sZW5ndGgpLCBteD10ZW1wVWlBcnIubGVuZ3RoO1xuXHRcdFx0XHRmb3IoaTtpPG14OysraSkgdGVtcFVpQXJyW2ldPSBwYXlsb2FkLmNoYXJDb2RlQXQoaSk7XG5cdFx0XHQgXHRwYXlsb2FkPW5ldyBteUJsb2IoW3RlbXBVaUFycl0sIHt0eXBlOiBtaW1lVHlwZX0pO1xuXHRcdFx0fVx0XHQgIFxuXHRcdH1cblx0XHRibG9iID0gcGF5bG9hZCBpbnN0YW5jZW9mIG15QmxvYiA/XG5cdFx0XHRwYXlsb2FkIDpcblx0XHRcdG5ldyBteUJsb2IoW3BheWxvYWRdLCB7dHlwZTogbWltZVR5cGV9KSA7XG5cblxuXHRcdGZ1bmN0aW9uIGRhdGFVcmxUb0Jsb2Ioc3RyVXJsKSB7XG5cdFx0XHR2YXIgcGFydHM9IHN0clVybC5zcGxpdCgvWzo7LF0vKSxcblx0XHRcdHR5cGU9IHBhcnRzWzFdLFxuXHRcdFx0ZGVjb2Rlcj0gcGFydHNbMl0gPT0gXCJiYXNlNjRcIiA/IGF0b2IgOiBkZWNvZGVVUklDb21wb25lbnQsXG5cdFx0XHRiaW5EYXRhPSBkZWNvZGVyKCBwYXJ0cy5wb3AoKSApLFxuXHRcdFx0bXg9IGJpbkRhdGEubGVuZ3RoLFxuXHRcdFx0aT0gMCxcblx0XHRcdHVpQXJyPSBuZXcgVWludDhBcnJheShteCk7XG5cblx0XHRcdGZvcihpO2k8bXg7KytpKSB1aUFycltpXT0gYmluRGF0YS5jaGFyQ29kZUF0KGkpO1xuXG5cdFx0XHRyZXR1cm4gbmV3IG15QmxvYihbdWlBcnJdLCB7dHlwZTogdHlwZX0pO1xuXHRcdCB9XG5cblx0XHRmdW5jdGlvbiBzYXZlcih1cmwsIHdpbk1vZGUpe1xuXG5cdFx0XHRpZiAoJ2Rvd25sb2FkJyBpbiBhbmNob3IpIHsgLy9odG1sNSBBW2Rvd25sb2FkXVxuXHRcdFx0XHRhbmNob3IuaHJlZiA9IHVybDtcblx0XHRcdFx0YW5jaG9yLnNldEF0dHJpYnV0ZShcImRvd25sb2FkXCIsIGZpbGVOYW1lKTtcblx0XHRcdFx0YW5jaG9yLmNsYXNzTmFtZSA9IFwiZG93bmxvYWQtanMtbGlua1wiO1xuXHRcdFx0XHRhbmNob3IuaW5uZXJIVE1MID0gXCJkb3dubG9hZGluZy4uLlwiO1xuXHRcdFx0XHRhbmNob3Iuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuXHRcdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGFuY2hvcik7XG5cdFx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XG5cdFx0XHRcdFx0YW5jaG9yLmNsaWNrKCk7XG5cdFx0XHRcdFx0ZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChhbmNob3IpO1xuXHRcdFx0XHRcdGlmKHdpbk1vZGU9PT10cnVlKXtzZXRUaW1lb3V0KGZ1bmN0aW9uKCl7IHNlbGYuVVJMLnJldm9rZU9iamVjdFVSTChhbmNob3IuaHJlZik7fSwgMjUwICk7fVxuXHRcdFx0XHR9LCA2Nik7XG5cdFx0XHRcdHJldHVybiB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHQvLyBoYW5kbGUgbm9uLWFbZG93bmxvYWRdIHNhZmFyaSBhcyBiZXN0IHdlIGNhbjpcblx0XHRcdGlmKC8oVmVyc2lvbilcXC8oXFxkKylcXC4oXFxkKykoPzpcXC4oXFxkKykpPy4qU2FmYXJpXFwvLy50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XG5cdFx0XHRcdGlmKC9eZGF0YTovLnRlc3QodXJsKSlcdHVybD1cImRhdGE6XCIrdXJsLnJlcGxhY2UoL15kYXRhOihbXFx3XFwvXFwtXFwrXSspLywgZGVmYXVsdE1pbWUpO1xuXHRcdFx0XHRpZighd2luZG93Lm9wZW4odXJsKSl7IC8vIHBvcHVwIGJsb2NrZWQsIG9mZmVyIGRpcmVjdCBkb3dubG9hZDpcblx0XHRcdFx0XHRpZihjb25maXJtKFwiRGlzcGxheWluZyBOZXcgRG9jdW1lbnRcXG5cXG5Vc2UgU2F2ZSBBcy4uLiB0byBkb3dubG9hZCwgdGhlbiBjbGljayBiYWNrIHRvIHJldHVybiB0byB0aGlzIHBhZ2UuXCIpKXsgbG9jYXRpb24uaHJlZj11cmw7IH1cblx0XHRcdFx0fVxuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly9kbyBpZnJhbWUgZGF0YVVSTCBkb3dubG9hZCAob2xkIGNoK0ZGKTpcblx0XHRcdHZhciBmID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImlmcmFtZVwiKTtcblx0XHRcdGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQoZik7XG5cblx0XHRcdGlmKCF3aW5Nb2RlICYmIC9eZGF0YTovLnRlc3QodXJsKSl7IC8vIGZvcmNlIGEgbWltZSB0aGF0IHdpbGwgZG93bmxvYWQ6XG5cdFx0XHRcdHVybD1cImRhdGE6XCIrdXJsLnJlcGxhY2UoL15kYXRhOihbXFx3XFwvXFwtXFwrXSspLywgZGVmYXVsdE1pbWUpO1xuXHRcdFx0fVxuXHRcdFx0Zi5zcmM9dXJsO1xuXHRcdFx0c2V0VGltZW91dChmdW5jdGlvbigpeyBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGYpOyB9LCAzMzMpO1xuXG5cdFx0fS8vZW5kIHNhdmVyXG5cblxuXG5cblx0XHRpZiAobmF2aWdhdG9yLm1zU2F2ZUJsb2IpIHsgLy8gSUUxMCsgOiAoaGFzIEJsb2IsIGJ1dCBub3QgYVtkb3dubG9hZF0gb3IgVVJMKVxuXHRcdFx0cmV0dXJuIG5hdmlnYXRvci5tc1NhdmVCbG9iKGJsb2IsIGZpbGVOYW1lKTtcblx0XHR9XG5cblx0XHRpZihzZWxmLlVSTCl7IC8vIHNpbXBsZSBmYXN0IGFuZCBtb2Rlcm4gd2F5IHVzaW5nIEJsb2IgYW5kIFVSTDpcblx0XHRcdHNhdmVyKHNlbGYuVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKSwgdHJ1ZSk7XG5cdFx0fWVsc2V7XG5cdFx0XHQvLyBoYW5kbGUgbm9uLUJsb2IoKStub24tVVJMIGJyb3dzZXJzOlxuXHRcdFx0aWYodHlwZW9mIGJsb2IgPT09IFwic3RyaW5nXCIgfHwgYmxvYi5jb25zdHJ1Y3Rvcj09PXRvU3RyaW5nICl7XG5cdFx0XHRcdHRyeXtcblx0XHRcdFx0XHRyZXR1cm4gc2F2ZXIoIFwiZGF0YTpcIiArICBtaW1lVHlwZSAgICsgXCI7YmFzZTY0LFwiICArICBzZWxmLmJ0b2EoYmxvYikgICk7XG5cdFx0XHRcdH1jYXRjaCh5KXtcblx0XHRcdFx0XHRyZXR1cm4gc2F2ZXIoIFwiZGF0YTpcIiArICBtaW1lVHlwZSAgICsgXCIsXCIgKyBlbmNvZGVVUklDb21wb25lbnQoYmxvYikgICk7XG5cdFx0XHRcdH1cblx0XHRcdH1cblxuXHRcdFx0Ly8gQmxvYiBidXQgbm90IFVSTCBzdXBwb3J0OlxuXHRcdFx0cmVhZGVyPW5ldyBGaWxlUmVhZGVyKCk7XG5cdFx0XHRyZWFkZXIub25sb2FkPWZ1bmN0aW9uKGUpe1xuXHRcdFx0XHRzYXZlcih0aGlzLnJlc3VsdCk7XG5cdFx0XHR9O1xuXHRcdFx0cmVhZGVyLnJlYWRBc0RhdGFVUkwoYmxvYik7XG5cdFx0fVxuXHRcdHJldHVybiB0cnVlO1xuXHR9OyAvKiBlbmQgZG93bmxvYWQoKSAqL1xufSkpO1xuIl19"}