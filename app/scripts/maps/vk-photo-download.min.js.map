{"version":3,"sources":["node_modules/browser-pack/_prelude.js","app/scripts/modules/photo-download.js","app/scripts/vk-photo-download.js","node_modules/downloadjs/download.js"],"names":[],"mappings":"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;;;;;;;;AChQL;;;;AAGA,MAAM,CAAC,aAAP,GAAuB,IAAI,sBAAJ,EAAvB;;;ACHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"../vk-photo-download.min.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","import Download from 'downloadjs';\r\n\r\nexport default class PhotoDownload {\r\n    constructor() {\r\n        this.photoDownload_id = 'PhotoDownload';\r\n        this.imgContainer_id = 'pv_photo';\r\n        this.imgContainer_class = 'pv_image_wrap';\r\n\r\n        // Объект с описанием обработчиков\r\n        this.triggers = {\r\n            mouseover: [\r\n                // Селектор ссылки, в которую обернута картинка в просмотрщике\r\n                {\r\n                    type: 'id',\r\n                    selector: this.imgContainer_id,\r\n                    handler: this._updateBtn,\r\n                    child: true,\r\n                },\r\n                {\r\n                    type: 'class',\r\n                    selector: 'PhotoDownload_btn',\r\n                    handler: this._updateBtn,\r\n                    child: true,\r\n                },\r\n            ], // Конец mouseover\r\n        };\r\n\r\n        // id, который добавится тегу style\r\n        this.style_id = 'PhotoDownloadStyle';\r\n        // Объект, генерирующий разноцветные иконки\r\n        this.icons = {\r\n            _colors: {\r\n                green: '#00B75A',\r\n                red: '#F92672',\r\n                white: '#FFFFFF',\r\n                yellow: '#FFC000',\r\n            },\r\n            _prefix: 'data:image/svg+xml;charset=utf-8,',\r\n            /* html */\r\n            _template: `<svg xmlns=\"http://www.w3.org/2000/svg\" width=\"16\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\">\r\n                            <path fill=\"{{color}}\" d=\"M 4,0 4,8 0,8 8,16 16,8 12,8 12,0 4,0 z\"/>\r\n                        </svg>`,\r\n            _temp: function(color) {\r\n                return this._template.replace(/\\{\\{.*\\}\\}/gm, color ? color : 'white');\r\n            },\r\n            get(color, url = true) {\r\n                let _color = this._colors[color] ? this._colors[color] : color;\r\n                let svg = this._temp(_color).replace(/[\\s]{2,}/gm, ' ');\r\n                return url ? this._prefix + encodeURIComponent(svg) : svg;\r\n            }\r\n        };\r\n\r\n        this.last_image_data = {\r\n            src: null,\r\n            width: null,\r\n            height: null,\r\n        };\r\n\r\n\r\n        // Точка входа\r\n        this.init();\r\n    }\r\n\r\n    _updateBtn(elem) {\r\n        let parent = elem.closest('.' + this.imgContainer_class);\r\n\r\n        // Если в родительском контейнере еще нет кнопки\r\n        if (!parent.querySelector('#' + this.photoDownload_id)) {\r\n            // то создадим ее\r\n            this._createDownloadContainer(elem);\r\n        }\r\n\r\n        let btn = parent.querySelector('.PhotoDownload_btn');\r\n        let size = parent.querySelector('.PhotoDownload_size');\r\n        this.last_image_data = window.Photoview.genData(cur.pvCurPhoto);\r\n\r\n        // Если ссылка в кнопке не та, которая нужна сейчас\r\n        if (btn.href !== this.last_image_data.src) {\r\n            console.log('btn.href !== this.last_image_data.src');\r\n\r\n            btn.href = this.last_image_data.src;\r\n\r\n            if (this.last_image_data.width && this.last_image_data.height) {\r\n                size.classList.remove('non_size');\r\n                size.textContent = `${this.last_image_data.width}x${this.last_image_data.height}`;\r\n            } else {\r\n                size.classList.add('non_size');\r\n                size.textContent = '';\r\n            }\r\n        }\r\n    }\r\n\r\n    _createDownloadContainer(elem) {\r\n        let parent = elem.closest('.' + this.imgContainer_class);\r\n        let wrap = document.createElement('div');\r\n        wrap.id = this.photoDownload_id;\r\n\r\n        wrap.innerHTML = this._createInnerElems();\r\n\r\n        setTimeout(() => {\r\n            wrap.classList.add('ready');\r\n        }, 0);\r\n\r\n        parent.appendChild(wrap);\r\n    }\r\n\r\n    _createInnerElems() {\r\n        return /* html */ `\r\n            <a class=\"PhotoDownload_btn\" href=\"#!\" target=\"_blank\" draggable=\"false\">\r\n                <div class=\"PhotoDownload_icon\"></div>\r\n                <div class=\"PhotoDownload_size\"></div>\r\n            </a>\r\n        `;\r\n    }\r\n\r\n    _createStyleContent() {\r\n        return /* css */ `\r\n        #${this.photoDownload_id} {\r\n            background-color: #000;\r\n            border-top-left-radius: 4px;\r\n            position: absolute;\r\n            bottom: 0;\r\n            left: 100%;\r\n            opacity: 0;\r\n            transform: translate3d(-38px, 0, 1px);\r\n            will-change: transform, opacity;\r\n            transition: opacity .25s ease-in-out, transform .25s ease-in-out !important;\r\n        }\r\n        .${this.imgContainer_class}:hover #${this.photoDownload_id}.ready {\r\n            opacity: .3;\r\n        }\r\n        .${this.imgContainer_class} #${this.photoDownload_id}.ready:hover {\r\n            opacity: .8;\r\n            transform: translate3d(-100%, 0, 1px);\r\n        }\r\n        .PhotoDownload_btn {\r\n            display: flex;\r\n            align-items: center;\r\n            padding: 10px;\r\n        }\r\n        .PhotoDownload_btn:hover {\r\n            text-decoration: none;\r\n        }\r\n        .PhotoDownload_icon {\r\n            background-image: url('${this.icons.get('white')}');\r\n            background-size: contain;\r\n            background-repeat: no-repeat;\r\n            height: 18px;\r\n            width: 18px;\r\n        }\r\n        .PhotoDownload_btn:hover .PhotoDownload_icon {\r\n            background-image: url('${this.icons.get('green')}');\r\n        }\r\n        #${this.photoDownload_id} .PhotoDownload_size:not(.non_size) {\r\n            padding-left: 10px;\r\n            color: #C3CFE0 !important;\r\n        }\r\n        `;\r\n    }\r\n\r\n    // Метод для тестовой подсветки элемента на котором сработал watcher\r\n    _highlighter(elem, timeout) {\r\n        elem.classList.add('photo_download_highlight');\r\n\r\n        setTimeout(() => {\r\n            elem.classList.remove('photo_download_highlight');\r\n        }, timeout);\r\n    }\r\n\r\n    _checkComplianceChild(target, trigger) {\r\n        let parent = (trigger.type === 'id') ?\r\n            target.closest('#' + trigger.selector) :\r\n            target.closest('.' + trigger.selector);\r\n\r\n        if (parent) {\r\n            this._checkComplianceTarget(parent, trigger);\r\n        }\r\n    }\r\n\r\n    _checkComplianceTarget(target, trigger) {\r\n        let compliance = false;\r\n\r\n        // Два отдельных условия для того, чтобы была возможность назначить\r\n        // разные обработчики по id и по классу на один элемент, и они сработали оба\r\n        if (trigger.type === 'id') {\r\n            if (target.id === trigger.selector) {\r\n                compliance = true;\r\n\r\n                if (trigger.handler) {\r\n                    // console.log('> ' + trigger.selector);\r\n                    trigger.handler.call(this, target);\r\n                }\r\n            }\r\n        }\r\n\r\n        if (trigger.type === 'class') {\r\n            if (target.classList.contains(trigger.selector)) {\r\n                compliance = true;\r\n\r\n                if (trigger.handler) {\r\n                    // console.log('> ' + trigger.selector);\r\n                    trigger.handler.call(this, target);\r\n                }\r\n            }\r\n        }\r\n\r\n        return compliance;\r\n    }\r\n\r\n    // Метод, который вызывает нужный обработчик при нужном событии\r\n    _watchTrigger(event) {\r\n        // Смотрим, есть ли обработчики полученного типа события\r\n        // На самом деле они всегда должны быть, но все же\r\n        let triggers = this.triggers[event.type];\r\n        if (triggers === undefined) return;\r\n\r\n        // Берем элемент, на котором сработало событие\r\n        let target = event.target;\r\n\r\n        // Цикл по объекту обработчиков полученного типа события\r\n        triggers.forEach(trigger => {\r\n            // Если цели события нет в объекте обработчиков, но в обработчике указано, \r\n            // что он может срабатывать на дочернем элементе\r\n            if (!this._checkComplianceTarget(target, trigger) && trigger.child) {\r\n                // Попробуем найти родительский элемент цели, соответствующий селектору\r\n                // из объекта обработчиков\r\n                this._checkComplianceChild(target, trigger);\r\n            }\r\n        });\r\n    }\r\n\r\n    // Установка на document слушателей типов событий, имеющихся в объекте обработчиков\r\n    _initWatcher() {\r\n        let types = Object.keys(this.triggers);\r\n        types.forEach(type => document.addEventListener(type, this._watchTrigger.bind(this)))\r\n    }\r\n\r\n    // Метод добавления на страницу стилей, необходимых для работы PhotoDownload\r\n    _injectCSS() {\r\n        let style = document.createElement('style');\r\n        style.id = this.style_id;\r\n        style.textContent = this._createStyleContent();\r\n\r\n        document.head.appendChild(style);\r\n    }\r\n\r\n\r\n    // Точка входа\r\n    init() {\r\n        console.log('%c%s', (window.log_color) ? window.log_color.blue : '', 'PhotoDownload: Init');\r\n\r\n        // Добавляем стили PhotoDownload\r\n        this._injectCSS();\r\n\r\n        // Инициализируем обработчики событий\r\n        this._initWatcher();\r\n    }\r\n}","import PhotoDownload from './modules/photo-download';\r\n\r\n\r\nwindow.photoDownload = new PhotoDownload();","//download.js v4.2, by dandavis; 2008-2016. [MIT] see http://danml.com/download.html for tests/usage\n// v1 landed a FF+Chrome compat way of downloading strings to local un-named files, upgraded to use a hidden frame and optional mime\n// v2 added named files via a[download], msSaveBlob, IE (10+) support, and window.URL support for larger+faster saves than dataURLs\n// v3 added dataURL and Blob Input, bind-toggle arity, and legacy dataURL fallback was improved with force-download mime and base64 support. 3.1 improved safari handling.\n// v4 adds AMD/UMD, commonJS, and plain browser support\n// v4.1 adds url download capability via solo URL argument (same domain/CORS only)\n// v4.2 adds semantic variable names, long (over 2MB) dataURL support, and hidden by default temp anchors\n// https://github.com/rndme/download\n\n(function (root, factory) {\n\tif (typeof define === 'function' && define.amd) {\n\t\t// AMD. Register as an anonymous module.\n\t\tdefine([], factory);\n\t} else if (typeof exports === 'object') {\n\t\t// Node. Does not work with strict CommonJS, but\n\t\t// only CommonJS-like environments that support module.exports,\n\t\t// like Node.\n\t\tmodule.exports = factory();\n\t} else {\n\t\t// Browser globals (root is window)\n\t\troot.download = factory();\n  }\n}(this, function () {\n\n\treturn function download(data, strFileName, strMimeType) {\n\n\t\tvar self = window, // this script is only for browsers anyway...\n\t\t\tdefaultMime = \"application/octet-stream\", // this default mime also triggers iframe downloads\n\t\t\tmimeType = strMimeType || defaultMime,\n\t\t\tpayload = data,\n\t\t\turl = !strFileName && !strMimeType && payload,\n\t\t\tanchor = document.createElement(\"a\"),\n\t\t\ttoString = function(a){return String(a);},\n\t\t\tmyBlob = (self.Blob || self.MozBlob || self.WebKitBlob || toString),\n\t\t\tfileName = strFileName || \"download\",\n\t\t\tblob,\n\t\t\treader;\n\t\t\tmyBlob= myBlob.call ? myBlob.bind(self) : Blob ;\n\t  \n\t\tif(String(this)===\"true\"){ //reverse arguments, allowing download.bind(true, \"text/xml\", \"export.xml\") to act as a callback\n\t\t\tpayload=[payload, mimeType];\n\t\t\tmimeType=payload[0];\n\t\t\tpayload=payload[1];\n\t\t}\n\n\n\t\tif(url && url.length< 2048){ // if no filename and no mime, assume a url was passed as the only argument\n\t\t\tfileName = url.split(\"/\").pop().split(\"?\")[0];\n\t\t\tanchor.href = url; // assign href prop to temp anchor\n\t\t  \tif(anchor.href.indexOf(url) !== -1){ // if the browser determines that it's a potentially valid url path:\n        \t\tvar ajax=new XMLHttpRequest();\n        \t\tajax.open( \"GET\", url, true);\n        \t\tajax.responseType = 'blob';\n        \t\tajax.onload= function(e){ \n\t\t\t\t  download(e.target.response, fileName, defaultMime);\n\t\t\t\t};\n        \t\tsetTimeout(function(){ ajax.send();}, 0); // allows setting custom ajax headers using the return:\n\t\t\t    return ajax;\n\t\t\t} // end if valid url?\n\t\t} // end if url?\n\n\n\t\t//go ahead and download dataURLs right away\n\t\tif(/^data:([\\w+-]+\\/[\\w+.-]+)?[,;]/.test(payload)){\n\t\t\n\t\t\tif(payload.length > (1024*1024*1.999) && myBlob !== toString ){\n\t\t\t\tpayload=dataUrlToBlob(payload);\n\t\t\t\tmimeType=payload.type || defaultMime;\n\t\t\t}else{\t\t\t\n\t\t\t\treturn navigator.msSaveBlob ?  // IE10 can't do a[download], only Blobs:\n\t\t\t\t\tnavigator.msSaveBlob(dataUrlToBlob(payload), fileName) :\n\t\t\t\t\tsaver(payload) ; // everyone else can save dataURLs un-processed\n\t\t\t}\n\t\t\t\n\t\t}else{//not data url, is it a string with special needs?\n\t\t\tif(/([\\x80-\\xff])/.test(payload)){\t\t\t  \n\t\t\t\tvar i=0, tempUiArr= new Uint8Array(payload.length), mx=tempUiArr.length;\n\t\t\t\tfor(i;i<mx;++i) tempUiArr[i]= payload.charCodeAt(i);\n\t\t\t \tpayload=new myBlob([tempUiArr], {type: mimeType});\n\t\t\t}\t\t  \n\t\t}\n\t\tblob = payload instanceof myBlob ?\n\t\t\tpayload :\n\t\t\tnew myBlob([payload], {type: mimeType}) ;\n\n\n\t\tfunction dataUrlToBlob(strUrl) {\n\t\t\tvar parts= strUrl.split(/[:;,]/),\n\t\t\ttype= parts[1],\n\t\t\tdecoder= parts[2] == \"base64\" ? atob : decodeURIComponent,\n\t\t\tbinData= decoder( parts.pop() ),\n\t\t\tmx= binData.length,\n\t\t\ti= 0,\n\t\t\tuiArr= new Uint8Array(mx);\n\n\t\t\tfor(i;i<mx;++i) uiArr[i]= binData.charCodeAt(i);\n\n\t\t\treturn new myBlob([uiArr], {type: type});\n\t\t }\n\n\t\tfunction saver(url, winMode){\n\n\t\t\tif ('download' in anchor) { //html5 A[download]\n\t\t\t\tanchor.href = url;\n\t\t\t\tanchor.setAttribute(\"download\", fileName);\n\t\t\t\tanchor.className = \"download-js-link\";\n\t\t\t\tanchor.innerHTML = \"downloading...\";\n\t\t\t\tanchor.style.display = \"none\";\n\t\t\t\tdocument.body.appendChild(anchor);\n\t\t\t\tsetTimeout(function() {\n\t\t\t\t\tanchor.click();\n\t\t\t\t\tdocument.body.removeChild(anchor);\n\t\t\t\t\tif(winMode===true){setTimeout(function(){ self.URL.revokeObjectURL(anchor.href);}, 250 );}\n\t\t\t\t}, 66);\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// handle non-a[download] safari as best we can:\n\t\t\tif(/(Version)\\/(\\d+)\\.(\\d+)(?:\\.(\\d+))?.*Safari\\//.test(navigator.userAgent)) {\n\t\t\t\tif(/^data:/.test(url))\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t\tif(!window.open(url)){ // popup blocked, offer direct download:\n\t\t\t\t\tif(confirm(\"Displaying New Document\\n\\nUse Save As... to download, then click back to return to this page.\")){ location.href=url; }\n\t\t\t\t}\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t//do iframe dataURL download (old ch+FF):\n\t\t\tvar f = document.createElement(\"iframe\");\n\t\t\tdocument.body.appendChild(f);\n\n\t\t\tif(!winMode && /^data:/.test(url)){ // force a mime that will download:\n\t\t\t\turl=\"data:\"+url.replace(/^data:([\\w\\/\\-\\+]+)/, defaultMime);\n\t\t\t}\n\t\t\tf.src=url;\n\t\t\tsetTimeout(function(){ document.body.removeChild(f); }, 333);\n\n\t\t}//end saver\n\n\n\n\n\t\tif (navigator.msSaveBlob) { // IE10+ : (has Blob, but not a[download] or URL)\n\t\t\treturn navigator.msSaveBlob(blob, fileName);\n\t\t}\n\n\t\tif(self.URL){ // simple fast and modern way using Blob and URL:\n\t\t\tsaver(self.URL.createObjectURL(blob), true);\n\t\t}else{\n\t\t\t// handle non-Blob()+non-URL browsers:\n\t\t\tif(typeof blob === \"string\" || blob.constructor===toString ){\n\t\t\t\ttry{\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \";base64,\"  +  self.btoa(blob)  );\n\t\t\t\t}catch(y){\n\t\t\t\t\treturn saver( \"data:\" +  mimeType   + \",\" + encodeURIComponent(blob)  );\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Blob but not URL support:\n\t\t\treader=new FileReader();\n\t\t\treader.onload=function(e){\n\t\t\t\tsaver(this.result);\n\t\t\t};\n\t\t\treader.readAsDataURL(blob);\n\t\t}\n\t\treturn true;\n\t}; /* end download() */\n}));\n"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJhcHAvc2NyaXB0cy9tb2R1bGVzL3Bob3RvLWRvd25sb2FkLmpzIiwiYXBwL3NjcmlwdHMvdmstcGhvdG8tZG93bmxvYWQuanMiLCJub2RlX21vZHVsZXMvZG93bmxvYWRqcy9kb3dubG9hZC5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7Ozs7QUNBQTs7Ozs7Ozs7OztJQUVxQixhOzs7QUFDakIsMkJBQWM7QUFBQTs7QUFDVixTQUFLLGdCQUFMLEdBQXdCLGVBQXhCO0FBQ0EsU0FBSyxlQUFMLEdBQXVCLFVBQXZCO0FBQ0EsU0FBSyxrQkFBTCxHQUEwQixlQUExQixDQUhVLENBS1Y7O0FBQ0EsU0FBSyxRQUFMLEdBQWdCO0FBQ1osTUFBQSxTQUFTLEVBQUUsQ0FDUDtBQUNBO0FBQ0ksUUFBQSxJQUFJLEVBQUUsSUFEVjtBQUVJLFFBQUEsUUFBUSxFQUFFLEtBQUssZUFGbkI7QUFHSSxRQUFBLE9BQU8sRUFBRSxLQUFLLFVBSGxCO0FBSUksUUFBQSxLQUFLLEVBQUU7QUFKWCxPQUZPLEVBUVA7QUFDSSxRQUFBLElBQUksRUFBRSxPQURWO0FBRUksUUFBQSxRQUFRLEVBQUUsbUJBRmQ7QUFHSSxRQUFBLE9BQU8sRUFBRSxLQUFLLFVBSGxCO0FBSUksUUFBQSxLQUFLLEVBQUU7QUFKWCxPQVJPLENBREMsQ0FlVDs7QUFmUyxLQUFoQixDQU5VLENBd0JWOztBQUNBLFNBQUssUUFBTCxHQUFnQixvQkFBaEIsQ0F6QlUsQ0EwQlY7O0FBQ0EsU0FBSyxLQUFMLEdBQWE7QUFDVCxNQUFBLE9BQU8sRUFBRTtBQUNMLFFBQUEsS0FBSyxFQUFFLFNBREY7QUFFTCxRQUFBLEdBQUcsRUFBRSxTQUZBO0FBR0wsUUFBQSxLQUFLLEVBQUUsU0FIRjtBQUlMLFFBQUEsTUFBTSxFQUFFO0FBSkgsT0FEQTtBQU9ULE1BQUEsT0FBTyxFQUFFLG1DQVBBOztBQVFUO0FBQ0EsTUFBQSxTQUFTLHFQQVRBO0FBWVQsTUFBQSxLQUFLLEVBQUUsZUFBUyxLQUFULEVBQWdCO0FBQ25CLGVBQU8sS0FBSyxTQUFMLENBQWUsT0FBZixDQUF1QixjQUF2QixFQUF1QyxLQUFLLEdBQUcsS0FBSCxHQUFXLE9BQXZELENBQVA7QUFDSCxPQWRRO0FBZVQsTUFBQSxHQWZTLGVBZUwsS0FmSyxFQWVjO0FBQUEsWUFBWixHQUFZLHVFQUFOLElBQU07O0FBQ25CLFlBQUksTUFBTSxHQUFHLEtBQUssT0FBTCxDQUFhLEtBQWIsSUFBc0IsS0FBSyxPQUFMLENBQWEsS0FBYixDQUF0QixHQUE0QyxLQUF6RDs7QUFDQSxZQUFJLEdBQUcsR0FBRyxLQUFLLEtBQUwsQ0FBVyxNQUFYLEVBQW1CLE9BQW5CLENBQTJCLFlBQTNCLEVBQXlDLEdBQXpDLENBQVY7O0FBQ0EsZUFBTyxHQUFHLEdBQUcsS0FBSyxPQUFMLEdBQWUsa0JBQWtCLENBQUMsR0FBRCxDQUFwQyxHQUE0QyxHQUF0RDtBQUNIO0FBbkJRLEtBQWI7QUFzQkEsU0FBSyxlQUFMLEdBQXVCO0FBQ25CLE1BQUEsR0FBRyxFQUFFLElBRGM7QUFFbkIsTUFBQSxLQUFLLEVBQUUsSUFGWTtBQUduQixNQUFBLE1BQU0sRUFBRTtBQUhXLEtBQXZCLENBakRVLENBd0RWOztBQUNBLFNBQUssSUFBTDtBQUNIOzs7OytCQUVVLEksRUFBTTtBQUNiLFVBQUksTUFBTSxHQUFHLElBQUksQ0FBQyxPQUFMLENBQWEsTUFBTSxLQUFLLGtCQUF4QixDQUFiLENBRGEsQ0FHYjs7QUFDQSxVQUFJLENBQUMsTUFBTSxDQUFDLGFBQVAsQ0FBcUIsTUFBTSxLQUFLLGdCQUFoQyxDQUFMLEVBQXdEO0FBQ3BEO0FBQ0EsYUFBSyx3QkFBTCxDQUE4QixJQUE5QjtBQUNIOztBQUVELFVBQUksR0FBRyxHQUFHLE1BQU0sQ0FBQyxhQUFQLENBQXFCLG9CQUFyQixDQUFWO0FBQ0EsVUFBSSxJQUFJLEdBQUcsTUFBTSxDQUFDLGFBQVAsQ0FBcUIscUJBQXJCLENBQVg7QUFDQSxXQUFLLGVBQUwsR0FBdUIsTUFBTSxDQUFDLFNBQVAsQ0FBaUIsT0FBakIsQ0FBeUIsR0FBRyxDQUFDLFVBQTdCLENBQXZCLENBWGEsQ0FhYjs7QUFDQSxVQUFJLEdBQUcsQ0FBQyxJQUFKLEtBQWEsS0FBSyxlQUFMLENBQXFCLEdBQXRDLEVBQTJDO0FBQ3ZDLFFBQUEsT0FBTyxDQUFDLEdBQVIsQ0FBWSx1Q0FBWjtBQUVBLFFBQUEsR0FBRyxDQUFDLElBQUosR0FBVyxLQUFLLGVBQUwsQ0FBcUIsR0FBaEM7O0FBRUEsWUFBSSxLQUFLLGVBQUwsQ0FBcUIsS0FBckIsSUFBOEIsS0FBSyxlQUFMLENBQXFCLE1BQXZELEVBQStEO0FBQzNELFVBQUEsSUFBSSxDQUFDLFNBQUwsQ0FBZSxNQUFmLENBQXNCLFVBQXRCO0FBQ0EsVUFBQSxJQUFJLENBQUMsV0FBTCxhQUFzQixLQUFLLGVBQUwsQ0FBcUIsS0FBM0MsY0FBb0QsS0FBSyxlQUFMLENBQXFCLE1BQXpFO0FBQ0gsU0FIRCxNQUdPO0FBQ0gsVUFBQSxJQUFJLENBQUMsU0FBTCxDQUFlLEdBQWYsQ0FBbUIsVUFBbkI7QUFDQSxVQUFBLElBQUksQ0FBQyxXQUFMLEdBQW1CLEVBQW5CO0FBQ0g7QUFDSjtBQUNKOzs7NkNBRXdCLEksRUFBTTtBQUMzQixVQUFJLE1BQU0sR0FBRyxJQUFJLENBQUMsT0FBTCxDQUFhLE1BQU0sS0FBSyxrQkFBeEIsQ0FBYjtBQUNBLFVBQUksSUFBSSxHQUFHLFFBQVEsQ0FBQyxhQUFULENBQXVCLEtBQXZCLENBQVg7QUFDQSxNQUFBLElBQUksQ0FBQyxFQUFMLEdBQVUsS0FBSyxnQkFBZjtBQUVBLE1BQUEsSUFBSSxDQUFDLFNBQUwsR0FBaUIsS0FBSyxpQkFBTCxFQUFqQjtBQUVBLE1BQUEsVUFBVSxDQUFDLFlBQU07QUFDYixRQUFBLElBQUksQ0FBQyxTQUFMLENBQWUsR0FBZixDQUFtQixPQUFuQjtBQUNILE9BRlMsRUFFUCxDQUZPLENBQVY7QUFJQSxNQUFBLE1BQU0sQ0FBQyxXQUFQLENBQW1CLElBQW5CO0FBQ0g7Ozt3Q0FFbUI7QUFDaEI7QUFBTztBQUFQO0FBQUE7QUFNSDs7OzBDQUVxQjtBQUNsQjtBQUFPO0FBQVAsNkJBQ0csS0FBSyxnQkFEUiwyWkFZRyxLQUFLLGtCQVpSLHFCQVlxQyxLQUFLLGdCQVoxQyxxRUFlRyxLQUFLLGtCQWZSLGVBZStCLEtBQUssZ0JBZnBDLDhZQTRCNkIsS0FBSyxLQUFMLENBQVcsR0FBWCxDQUFlLE9BQWYsQ0E1QjdCLCtQQW1DNkIsS0FBSyxLQUFMLENBQVcsR0FBWCxDQUFlLE9BQWYsQ0FuQzdCLHNDQXFDRyxLQUFLLGdCQXJDUjtBQUFBO0FBMENILEssQ0FFRDs7OztpQ0FDYSxJLEVBQU0sTyxFQUFTO0FBQ3hCLE1BQUEsSUFBSSxDQUFDLFNBQUwsQ0FBZSxHQUFmLENBQW1CLDBCQUFuQjtBQUVBLE1BQUEsVUFBVSxDQUFDLFlBQU07QUFDYixRQUFBLElBQUksQ0FBQyxTQUFMLENBQWUsTUFBZixDQUFzQiwwQkFBdEI7QUFDSCxPQUZTLEVBRVAsT0FGTyxDQUFWO0FBR0g7OzswQ0FFcUIsTSxFQUFRLE8sRUFBUztBQUNuQyxVQUFJLE1BQU0sR0FBSSxPQUFPLENBQUMsSUFBUixLQUFpQixJQUFsQixHQUNULE1BQU0sQ0FBQyxPQUFQLENBQWUsTUFBTSxPQUFPLENBQUMsUUFBN0IsQ0FEUyxHQUVULE1BQU0sQ0FBQyxPQUFQLENBQWUsTUFBTSxPQUFPLENBQUMsUUFBN0IsQ0FGSjs7QUFJQSxVQUFJLE1BQUosRUFBWTtBQUNSLGFBQUssc0JBQUwsQ0FBNEIsTUFBNUIsRUFBb0MsT0FBcEM7QUFDSDtBQUNKOzs7MkNBRXNCLE0sRUFBUSxPLEVBQVM7QUFDcEMsVUFBSSxVQUFVLEdBQUcsS0FBakIsQ0FEb0MsQ0FHcEM7QUFDQTs7QUFDQSxVQUFJLE9BQU8sQ0FBQyxJQUFSLEtBQWlCLElBQXJCLEVBQTJCO0FBQ3ZCLFlBQUksTUFBTSxDQUFDLEVBQVAsS0FBYyxPQUFPLENBQUMsUUFBMUIsRUFBb0M7QUFDaEMsVUFBQSxVQUFVLEdBQUcsSUFBYjs7QUFFQSxjQUFJLE9BQU8sQ0FBQyxPQUFaLEVBQXFCO0FBQ2pCO0FBQ0EsWUFBQSxPQUFPLENBQUMsT0FBUixDQUFnQixJQUFoQixDQUFxQixJQUFyQixFQUEyQixNQUEzQjtBQUNIO0FBQ0o7QUFDSjs7QUFFRCxVQUFJLE9BQU8sQ0FBQyxJQUFSLEtBQWlCLE9BQXJCLEVBQThCO0FBQzFCLFlBQUksTUFBTSxDQUFDLFNBQVAsQ0FBaUIsUUFBakIsQ0FBMEIsT0FBTyxDQUFDLFFBQWxDLENBQUosRUFBaUQ7QUFDN0MsVUFBQSxVQUFVLEdBQUcsSUFBYjs7QUFFQSxjQUFJLE9BQU8sQ0FBQyxPQUFaLEVBQXFCO0FBQ2pCO0FBQ0EsWUFBQSxPQUFPLENBQUMsT0FBUixDQUFnQixJQUFoQixDQUFxQixJQUFyQixFQUEyQixNQUEzQjtBQUNIO0FBQ0o7QUFDSjs7QUFFRCxhQUFPLFVBQVA7QUFDSCxLLENBRUQ7Ozs7a0NBQ2MsSyxFQUFPO0FBQUE7O0FBQ2pCO0FBQ0E7QUFDQSxVQUFJLFFBQVEsR0FBRyxLQUFLLFFBQUwsQ0FBYyxLQUFLLENBQUMsSUFBcEIsQ0FBZjtBQUNBLFVBQUksUUFBUSxLQUFLLFNBQWpCLEVBQTRCLE9BSlgsQ0FNakI7O0FBQ0EsVUFBSSxNQUFNLEdBQUcsS0FBSyxDQUFDLE1BQW5CLENBUGlCLENBU2pCOztBQUNBLE1BQUEsUUFBUSxDQUFDLE9BQVQsQ0FBaUIsVUFBQSxPQUFPLEVBQUk7QUFDeEI7QUFDQTtBQUNBLFlBQUksQ0FBQyxLQUFJLENBQUMsc0JBQUwsQ0FBNEIsTUFBNUIsRUFBb0MsT0FBcEMsQ0FBRCxJQUFpRCxPQUFPLENBQUMsS0FBN0QsRUFBb0U7QUFDaEU7QUFDQTtBQUNBLFVBQUEsS0FBSSxDQUFDLHFCQUFMLENBQTJCLE1BQTNCLEVBQW1DLE9BQW5DO0FBQ0g7QUFDSixPQVJEO0FBU0gsSyxDQUVEOzs7O21DQUNlO0FBQUE7O0FBQ1gsVUFBSSxLQUFLLEdBQUcsTUFBTSxDQUFDLElBQVAsQ0FBWSxLQUFLLFFBQWpCLENBQVo7QUFDQSxNQUFBLEtBQUssQ0FBQyxPQUFOLENBQWMsVUFBQSxJQUFJO0FBQUEsZUFBSSxRQUFRLENBQUMsZ0JBQVQsQ0FBMEIsSUFBMUIsRUFBZ0MsTUFBSSxDQUFDLGFBQUwsQ0FBbUIsSUFBbkIsQ0FBd0IsTUFBeEIsQ0FBaEMsQ0FBSjtBQUFBLE9BQWxCO0FBQ0gsSyxDQUVEOzs7O2lDQUNhO0FBQ1QsVUFBSSxLQUFLLEdBQUcsUUFBUSxDQUFDLGFBQVQsQ0FBdUIsT0FBdkIsQ0FBWjtBQUNBLE1BQUEsS0FBSyxDQUFDLEVBQU4sR0FBVyxLQUFLLFFBQWhCO0FBQ0EsTUFBQSxLQUFLLENBQUMsV0FBTixHQUFvQixLQUFLLG1CQUFMLEVBQXBCO0FBRUEsTUFBQSxRQUFRLENBQUMsSUFBVCxDQUFjLFdBQWQsQ0FBMEIsS0FBMUI7QUFDSCxLLENBR0Q7Ozs7MkJBQ087QUFDSCxNQUFBLE9BQU8sQ0FBQyxHQUFSLENBQVksTUFBWixFQUFxQixNQUFNLENBQUMsU0FBUixHQUFxQixNQUFNLENBQUMsU0FBUCxDQUFpQixJQUF0QyxHQUE2QyxFQUFqRSxFQUFxRSxxQkFBckUsRUFERyxDQUdIOztBQUNBLFdBQUssVUFBTCxHQUpHLENBTUg7OztBQUNBLFdBQUssWUFBTDtBQUNIOzs7Ozs7Ozs7OztBQ2hRTDs7OztBQUdBLE1BQU0sQ0FBQyxhQUFQLEdBQXVCLElBQUksc0JBQUosRUFBdkI7OztBQ0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImltcG9ydCBEb3dubG9hZCBmcm9tICdkb3dubG9hZGpzJztcclxuXHJcbmV4cG9ydCBkZWZhdWx0IGNsYXNzIFBob3RvRG93bmxvYWQge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5waG90b0Rvd25sb2FkX2lkID0gJ1Bob3RvRG93bmxvYWQnO1xyXG4gICAgICAgIHRoaXMuaW1nQ29udGFpbmVyX2lkID0gJ3B2X3Bob3RvJztcclxuICAgICAgICB0aGlzLmltZ0NvbnRhaW5lcl9jbGFzcyA9ICdwdl9pbWFnZV93cmFwJztcclxuXHJcbiAgICAgICAgLy8g0J7QsdGK0LXQutGCINGBINC+0L/QuNGB0LDQvdC40LXQvCDQvtCx0YDQsNCx0L7RgtGH0LjQutC+0LJcclxuICAgICAgICB0aGlzLnRyaWdnZXJzID0ge1xyXG4gICAgICAgICAgICBtb3VzZW92ZXI6IFtcclxuICAgICAgICAgICAgICAgIC8vINCh0LXQu9C10LrRgtC+0YAg0YHRgdGL0LvQutC4LCDQsiDQutC+0YLQvtGA0YPRjiDQvtCx0LXRgNC90YPRgtCwINC60LDRgNGC0LjQvdC60LAg0LIg0L/RgNC+0YHQvNC+0YLRgNGJ0LjQutC1XHJcbiAgICAgICAgICAgICAgICB7XHJcbiAgICAgICAgICAgICAgICAgICAgdHlwZTogJ2lkJyxcclxuICAgICAgICAgICAgICAgICAgICBzZWxlY3RvcjogdGhpcy5pbWdDb250YWluZXJfaWQsXHJcbiAgICAgICAgICAgICAgICAgICAgaGFuZGxlcjogdGhpcy5fdXBkYXRlQnRuLFxyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHtcclxuICAgICAgICAgICAgICAgICAgICB0eXBlOiAnY2xhc3MnLFxyXG4gICAgICAgICAgICAgICAgICAgIHNlbGVjdG9yOiAnUGhvdG9Eb3dubG9hZF9idG4nLFxyXG4gICAgICAgICAgICAgICAgICAgIGhhbmRsZXI6IHRoaXMuX3VwZGF0ZUJ0bixcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZDogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIF0sIC8vINCa0L7QvdC10YYgbW91c2VvdmVyXHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgLy8gaWQsINC60L7RgtC+0YDRi9C5INC00L7QsdCw0LLQuNGC0YHRjyDRgtC10LPRgyBzdHlsZVxyXG4gICAgICAgIHRoaXMuc3R5bGVfaWQgPSAnUGhvdG9Eb3dubG9hZFN0eWxlJztcclxuICAgICAgICAvLyDQntCx0YrQtdC60YIsINCz0LXQvdC10YDQuNGA0YPRjtGJ0LjQuSDRgNCw0LfQvdC+0YbQstC10YLQvdGL0LUg0LjQutC+0L3QutC4XHJcbiAgICAgICAgdGhpcy5pY29ucyA9IHtcclxuICAgICAgICAgICAgX2NvbG9yczoge1xyXG4gICAgICAgICAgICAgICAgZ3JlZW46ICcjMDBCNzVBJyxcclxuICAgICAgICAgICAgICAgIHJlZDogJyNGOTI2NzInLFxyXG4gICAgICAgICAgICAgICAgd2hpdGU6ICcjRkZGRkZGJyxcclxuICAgICAgICAgICAgICAgIHllbGxvdzogJyNGRkMwMDAnLFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBfcHJlZml4OiAnZGF0YTppbWFnZS9zdmcreG1sO2NoYXJzZXQ9dXRmLTgsJyxcclxuICAgICAgICAgICAgLyogaHRtbCAqL1xyXG4gICAgICAgICAgICBfdGVtcGxhdGU6IGA8c3ZnIHhtbG5zPVwiaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmdcIiB3aWR0aD1cIjE2XCIgaGVpZ2h0PVwiMTZcIiB2ZXJzaW9uPVwiMS4xXCIgdmlld0JveD1cIjAgMCAxNiAxNlwiPlxyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgPHBhdGggZmlsbD1cInt7Y29sb3J9fVwiIGQ9XCJNIDQsMCA0LDggMCw4IDgsMTYgMTYsOCAxMiw4IDEyLDAgNCwwIHpcIi8+XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvc3ZnPmAsXHJcbiAgICAgICAgICAgIF90ZW1wOiBmdW5jdGlvbihjb2xvcikge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3RlbXBsYXRlLnJlcGxhY2UoL1xce1xcey4qXFx9XFx9L2dtLCBjb2xvciA/IGNvbG9yIDogJ3doaXRlJyk7XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIGdldChjb2xvciwgdXJsID0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IF9jb2xvciA9IHRoaXMuX2NvbG9yc1tjb2xvcl0gPyB0aGlzLl9jb2xvcnNbY29sb3JdIDogY29sb3I7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3ZnID0gdGhpcy5fdGVtcChfY29sb3IpLnJlcGxhY2UoL1tcXHNdezIsfS9nbSwgJyAnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybiB1cmwgPyB0aGlzLl9wcmVmaXggKyBlbmNvZGVVUklDb21wb25lbnQoc3ZnKSA6IHN2ZztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHRoaXMubGFzdF9pbWFnZV9kYXRhID0ge1xyXG4gICAgICAgICAgICBzcmM6IG51bGwsXHJcbiAgICAgICAgICAgIHdpZHRoOiBudWxsLFxyXG4gICAgICAgICAgICBoZWlnaHQ6IG51bGwsXHJcbiAgICAgICAgfTtcclxuXHJcblxyXG4gICAgICAgIC8vINCi0L7Rh9C60LAg0LLRhdC+0LTQsFxyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIF91cGRhdGVCdG4oZWxlbSkge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSBlbGVtLmNsb3Nlc3QoJy4nICsgdGhpcy5pbWdDb250YWluZXJfY2xhc3MpO1xyXG5cclxuICAgICAgICAvLyDQldGB0LvQuCDQsiDRgNC+0LTQuNGC0LXQu9GM0YHQutC+0Lwg0LrQvtC90YLQtdC50L3QtdGA0LUg0LXRidC1INC90LXRgiDQutC90L7Qv9C60LhcclxuICAgICAgICBpZiAoIXBhcmVudC5xdWVyeVNlbGVjdG9yKCcjJyArIHRoaXMucGhvdG9Eb3dubG9hZF9pZCkpIHtcclxuICAgICAgICAgICAgLy8g0YLQviDRgdC+0LfQtNCw0LTQuNC8INC10LVcclxuICAgICAgICAgICAgdGhpcy5fY3JlYXRlRG93bmxvYWRDb250YWluZXIoZWxlbSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBsZXQgYnRuID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5QaG90b0Rvd25sb2FkX2J0bicpO1xyXG4gICAgICAgIGxldCBzaXplID0gcGFyZW50LnF1ZXJ5U2VsZWN0b3IoJy5QaG90b0Rvd25sb2FkX3NpemUnKTtcclxuICAgICAgICB0aGlzLmxhc3RfaW1hZ2VfZGF0YSA9IHdpbmRvdy5QaG90b3ZpZXcuZ2VuRGF0YShjdXIucHZDdXJQaG90byk7XHJcblxyXG4gICAgICAgIC8vINCV0YHQu9C4INGB0YHRi9C70LrQsCDQsiDQutC90L7Qv9C60LUg0L3QtSDRgtCwLCDQutC+0YLQvtGA0LDRjyDQvdGD0LbQvdCwINGB0LXQudGH0LDRgVxyXG4gICAgICAgIGlmIChidG4uaHJlZiAhPT0gdGhpcy5sYXN0X2ltYWdlX2RhdGEuc3JjKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdidG4uaHJlZiAhPT0gdGhpcy5sYXN0X2ltYWdlX2RhdGEuc3JjJyk7XHJcblxyXG4gICAgICAgICAgICBidG4uaHJlZiA9IHRoaXMubGFzdF9pbWFnZV9kYXRhLnNyYztcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLmxhc3RfaW1hZ2VfZGF0YS53aWR0aCAmJiB0aGlzLmxhc3RfaW1hZ2VfZGF0YS5oZWlnaHQpIHtcclxuICAgICAgICAgICAgICAgIHNpemUuY2xhc3NMaXN0LnJlbW92ZSgnbm9uX3NpemUnKTtcclxuICAgICAgICAgICAgICAgIHNpemUudGV4dENvbnRlbnQgPSBgJHt0aGlzLmxhc3RfaW1hZ2VfZGF0YS53aWR0aH14JHt0aGlzLmxhc3RfaW1hZ2VfZGF0YS5oZWlnaHR9YDtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHNpemUuY2xhc3NMaXN0LmFkZCgnbm9uX3NpemUnKTtcclxuICAgICAgICAgICAgICAgIHNpemUudGV4dENvbnRlbnQgPSAnJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlRG93bmxvYWRDb250YWluZXIoZWxlbSkge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSBlbGVtLmNsb3Nlc3QoJy4nICsgdGhpcy5pbWdDb250YWluZXJfY2xhc3MpO1xyXG4gICAgICAgIGxldCB3cmFwID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XHJcbiAgICAgICAgd3JhcC5pZCA9IHRoaXMucGhvdG9Eb3dubG9hZF9pZDtcclxuXHJcbiAgICAgICAgd3JhcC5pbm5lckhUTUwgPSB0aGlzLl9jcmVhdGVJbm5lckVsZW1zKCk7XHJcblxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICB3cmFwLmNsYXNzTGlzdC5hZGQoJ3JlYWR5Jyk7XHJcbiAgICAgICAgfSwgMCk7XHJcblxyXG4gICAgICAgIHBhcmVudC5hcHBlbmRDaGlsZCh3cmFwKTtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlSW5uZXJFbGVtcygpIHtcclxuICAgICAgICByZXR1cm4gLyogaHRtbCAqLyBgXHJcbiAgICAgICAgICAgIDxhIGNsYXNzPVwiUGhvdG9Eb3dubG9hZF9idG5cIiBocmVmPVwiIyFcIiB0YXJnZXQ9XCJfYmxhbmtcIiBkcmFnZ2FibGU9XCJmYWxzZVwiPlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIlBob3RvRG93bmxvYWRfaWNvblwiPjwvZGl2PlxyXG4gICAgICAgICAgICAgICAgPGRpdiBjbGFzcz1cIlBob3RvRG93bmxvYWRfc2l6ZVwiPjwvZGl2PlxyXG4gICAgICAgICAgICA8L2E+XHJcbiAgICAgICAgYDtcclxuICAgIH1cclxuXHJcbiAgICBfY3JlYXRlU3R5bGVDb250ZW50KCkge1xyXG4gICAgICAgIHJldHVybiAvKiBjc3MgKi8gYFxyXG4gICAgICAgICMke3RoaXMucGhvdG9Eb3dubG9hZF9pZH0ge1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwO1xyXG4gICAgICAgICAgICBib3JkZXItdG9wLWxlZnQtcmFkaXVzOiA0cHg7XHJcbiAgICAgICAgICAgIHBvc2l0aW9uOiBhYnNvbHV0ZTtcclxuICAgICAgICAgICAgYm90dG9tOiAwO1xyXG4gICAgICAgICAgICBsZWZ0OiAxMDAlO1xyXG4gICAgICAgICAgICBvcGFjaXR5OiAwO1xyXG4gICAgICAgICAgICB0cmFuc2Zvcm06IHRyYW5zbGF0ZTNkKC0zOHB4LCAwLCAxcHgpO1xyXG4gICAgICAgICAgICB3aWxsLWNoYW5nZTogdHJhbnNmb3JtLCBvcGFjaXR5O1xyXG4gICAgICAgICAgICB0cmFuc2l0aW9uOiBvcGFjaXR5IC4yNXMgZWFzZS1pbi1vdXQsIHRyYW5zZm9ybSAuMjVzIGVhc2UtaW4tb3V0ICFpbXBvcnRhbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC4ke3RoaXMuaW1nQ29udGFpbmVyX2NsYXNzfTpob3ZlciAjJHt0aGlzLnBob3RvRG93bmxvYWRfaWR9LnJlYWR5IHtcclxuICAgICAgICAgICAgb3BhY2l0eTogLjM7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC4ke3RoaXMuaW1nQ29udGFpbmVyX2NsYXNzfSAjJHt0aGlzLnBob3RvRG93bmxvYWRfaWR9LnJlYWR5OmhvdmVyIHtcclxuICAgICAgICAgICAgb3BhY2l0eTogLjg7XHJcbiAgICAgICAgICAgIHRyYW5zZm9ybTogdHJhbnNsYXRlM2QoLTEwMCUsIDAsIDFweCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5QaG90b0Rvd25sb2FkX2J0biB7XHJcbiAgICAgICAgICAgIGRpc3BsYXk6IGZsZXg7XHJcbiAgICAgICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7XHJcbiAgICAgICAgICAgIHBhZGRpbmc6IDEwcHg7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC5QaG90b0Rvd25sb2FkX2J0bjpob3ZlciB7XHJcbiAgICAgICAgICAgIHRleHQtZGVjb3JhdGlvbjogbm9uZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgLlBob3RvRG93bmxvYWRfaWNvbiB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgnJHt0aGlzLmljb25zLmdldCgnd2hpdGUnKX0nKTtcclxuICAgICAgICAgICAgYmFja2dyb3VuZC1zaXplOiBjb250YWluO1xyXG4gICAgICAgICAgICBiYWNrZ3JvdW5kLXJlcGVhdDogbm8tcmVwZWF0O1xyXG4gICAgICAgICAgICBoZWlnaHQ6IDE4cHg7XHJcbiAgICAgICAgICAgIHdpZHRoOiAxOHB4O1xyXG4gICAgICAgIH1cclxuICAgICAgICAuUGhvdG9Eb3dubG9hZF9idG46aG92ZXIgLlBob3RvRG93bmxvYWRfaWNvbiB7XHJcbiAgICAgICAgICAgIGJhY2tncm91bmQtaW1hZ2U6IHVybCgnJHt0aGlzLmljb25zLmdldCgnZ3JlZW4nKX0nKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgIyR7dGhpcy5waG90b0Rvd25sb2FkX2lkfSAuUGhvdG9Eb3dubG9hZF9zaXplOm5vdCgubm9uX3NpemUpIHtcclxuICAgICAgICAgICAgcGFkZGluZy1sZWZ0OiAxMHB4O1xyXG4gICAgICAgICAgICBjb2xvcjogI0MzQ0ZFMCAhaW1wb3J0YW50O1xyXG4gICAgICAgIH1cclxuICAgICAgICBgO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINCc0LXRgtC+0LQg0LTQu9GPINGC0LXRgdGC0L7QstC+0Lkg0L/QvtC00YHQstC10YLQutC4INGN0LvQtdC80LXQvdGC0LAg0L3QsCDQutC+0YLQvtGA0L7QvCDRgdGA0LDQsdC+0YLQsNC7IHdhdGNoZXJcclxuICAgIF9oaWdobGlnaHRlcihlbGVtLCB0aW1lb3V0KSB7XHJcbiAgICAgICAgZWxlbS5jbGFzc0xpc3QuYWRkKCdwaG90b19kb3dubG9hZF9oaWdobGlnaHQnKTtcclxuXHJcbiAgICAgICAgc2V0VGltZW91dCgoKSA9PiB7XHJcbiAgICAgICAgICAgIGVsZW0uY2xhc3NMaXN0LnJlbW92ZSgncGhvdG9fZG93bmxvYWRfaGlnaGxpZ2h0Jyk7XHJcbiAgICAgICAgfSwgdGltZW91dCk7XHJcbiAgICB9XHJcblxyXG4gICAgX2NoZWNrQ29tcGxpYW5jZUNoaWxkKHRhcmdldCwgdHJpZ2dlcikge1xyXG4gICAgICAgIGxldCBwYXJlbnQgPSAodHJpZ2dlci50eXBlID09PSAnaWQnKSA/XHJcbiAgICAgICAgICAgIHRhcmdldC5jbG9zZXN0KCcjJyArIHRyaWdnZXIuc2VsZWN0b3IpIDpcclxuICAgICAgICAgICAgdGFyZ2V0LmNsb3Nlc3QoJy4nICsgdHJpZ2dlci5zZWxlY3Rvcik7XHJcblxyXG4gICAgICAgIGlmIChwYXJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5fY2hlY2tDb21wbGlhbmNlVGFyZ2V0KHBhcmVudCwgdHJpZ2dlcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIF9jaGVja0NvbXBsaWFuY2VUYXJnZXQodGFyZ2V0LCB0cmlnZ2VyKSB7XHJcbiAgICAgICAgbGV0IGNvbXBsaWFuY2UgPSBmYWxzZTtcclxuXHJcbiAgICAgICAgLy8g0JTQstCwINC+0YLQtNC10LvRjNC90YvRhSDRg9GB0LvQvtCy0LjRjyDQtNC70Y8g0YLQvtCz0L4sINGH0YLQvtCx0Ysg0LHRi9C70LAg0LLQvtC30LzQvtC20L3QvtGB0YLRjCDQvdCw0LfQvdCw0YfQuNGC0YxcclxuICAgICAgICAvLyDRgNCw0LfQvdGL0LUg0L7QsdGA0LDQsdC+0YLRh9C40LrQuCDQv9C+IGlkINC4INC/0L4g0LrQu9Cw0YHRgdGDINC90LAg0L7QtNC40L0g0Y3Qu9C10LzQtdC90YIsINC4INC+0L3QuCDRgdGA0LDQsdC+0YLQsNC70Lgg0L7QsdCwXHJcbiAgICAgICAgaWYgKHRyaWdnZXIudHlwZSA9PT0gJ2lkJykge1xyXG4gICAgICAgICAgICBpZiAodGFyZ2V0LmlkID09PSB0cmlnZ2VyLnNlbGVjdG9yKSB7XHJcbiAgICAgICAgICAgICAgICBjb21wbGlhbmNlID0gdHJ1ZTtcclxuXHJcbiAgICAgICAgICAgICAgICBpZiAodHJpZ2dlci5oYW5kbGVyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgLy8gY29uc29sZS5sb2coJz4gJyArIHRyaWdnZXIuc2VsZWN0b3IpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRyaWdnZXIuaGFuZGxlci5jYWxsKHRoaXMsIHRhcmdldCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmICh0cmlnZ2VyLnR5cGUgPT09ICdjbGFzcycpIHtcclxuICAgICAgICAgICAgaWYgKHRhcmdldC5jbGFzc0xpc3QuY29udGFpbnModHJpZ2dlci5zZWxlY3RvcikpIHtcclxuICAgICAgICAgICAgICAgIGNvbXBsaWFuY2UgPSB0cnVlO1xyXG5cclxuICAgICAgICAgICAgICAgIGlmICh0cmlnZ2VyLmhhbmRsZXIpIHtcclxuICAgICAgICAgICAgICAgICAgICAvLyBjb25zb2xlLmxvZygnPiAnICsgdHJpZ2dlci5zZWxlY3Rvcik7XHJcbiAgICAgICAgICAgICAgICAgICAgdHJpZ2dlci5oYW5kbGVyLmNhbGwodGhpcywgdGFyZ2V0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIGNvbXBsaWFuY2U7XHJcbiAgICB9XHJcblxyXG4gICAgLy8g0JzQtdGC0L7QtCwg0LrQvtGC0L7RgNGL0Lkg0LLRi9C30YvQstCw0LXRgiDQvdGD0LbQvdGL0Lkg0L7QsdGA0LDQsdC+0YLRh9C40Log0L/RgNC4INC90YPQttC90L7QvCDRgdC+0LHRi9GC0LjQuFxyXG4gICAgX3dhdGNoVHJpZ2dlcihldmVudCkge1xyXG4gICAgICAgIC8vINCh0LzQvtGC0YDQuNC8LCDQtdGB0YLRjCDQu9C4INC+0LHRgNCw0LHQvtGC0YfQuNC60Lgg0L/QvtC70YPRh9C10L3QvdC+0LPQviDRgtC40L/QsCDRgdC+0LHRi9GC0LjRj1xyXG4gICAgICAgIC8vINCd0LAg0YHQsNC80L7QvCDQtNC10LvQtSDQvtC90Lgg0LLRgdC10LPQtNCwINC00L7Qu9C20L3RiyDQsdGL0YLRjCwg0L3QviDQstGB0LUg0LbQtVxyXG4gICAgICAgIGxldCB0cmlnZ2VycyA9IHRoaXMudHJpZ2dlcnNbZXZlbnQudHlwZV07XHJcbiAgICAgICAgaWYgKHRyaWdnZXJzID09PSB1bmRlZmluZWQpIHJldHVybjtcclxuXHJcbiAgICAgICAgLy8g0JHQtdGA0LXQvCDRjdC70LXQvNC10L3Rgiwg0L3QsCDQutC+0YLQvtGA0L7QvCDRgdGA0LDQsdC+0YLQsNC70L4g0YHQvtCx0YvRgtC40LVcclxuICAgICAgICBsZXQgdGFyZ2V0ID0gZXZlbnQudGFyZ2V0O1xyXG5cclxuICAgICAgICAvLyDQptC40LrQuyDQv9C+INC+0LHRitC10LrRgtGDINC+0LHRgNCw0LHQvtGC0YfQuNC60L7QsiDQv9C+0LvRg9GH0LXQvdC90L7Qs9C+INGC0LjQv9CwINGB0L7QsdGL0YLQuNGPXHJcbiAgICAgICAgdHJpZ2dlcnMuZm9yRWFjaCh0cmlnZ2VyID0+IHtcclxuICAgICAgICAgICAgLy8g0JXRgdC70Lgg0YbQtdC70Lgg0YHQvtCx0YvRgtC40Y8g0L3QtdGCINCyINC+0LHRitC10LrRgtC1INC+0LHRgNCw0LHQvtGC0YfQuNC60L7Qsiwg0L3QviDQsiDQvtCx0YDQsNCx0L7RgtGH0LjQutC1INGD0LrQsNC30LDQvdC+LCBcclxuICAgICAgICAgICAgLy8g0YfRgtC+INC+0L0g0LzQvtC20LXRgiDRgdGA0LDQsdCw0YLRi9Cy0LDRgtGMINC90LAg0LTQvtGH0LXRgNC90LXQvCDRjdC70LXQvNC10L3RgtC1XHJcbiAgICAgICAgICAgIGlmICghdGhpcy5fY2hlY2tDb21wbGlhbmNlVGFyZ2V0KHRhcmdldCwgdHJpZ2dlcikgJiYgdHJpZ2dlci5jaGlsZCkge1xyXG4gICAgICAgICAgICAgICAgLy8g0J/QvtC/0YDQvtCx0YPQtdC8INC90LDQudGC0Lgg0YDQvtC00LjRgtC10LvRjNGB0LrQuNC5INGN0LvQtdC80LXQvdGCINGG0LXQu9C4LCDRgdC+0L7RgtCy0LXRgtGB0YLQstGD0Y7RidC40Lkg0YHQtdC70LXQutGC0L7RgNGDXHJcbiAgICAgICAgICAgICAgICAvLyDQuNC3INC+0LHRitC10LrRgtCwINC+0LHRgNCw0LHQvtGC0YfQuNC60L7QslxyXG4gICAgICAgICAgICAgICAgdGhpcy5fY2hlY2tDb21wbGlhbmNlQ2hpbGQodGFyZ2V0LCB0cmlnZ2VyKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vINCj0YHRgtCw0L3QvtCy0LrQsCDQvdCwIGRvY3VtZW50INGB0LvRg9GI0LDRgtC10LvQtdC5INGC0LjQv9C+0LIg0YHQvtCx0YvRgtC40LksINC40LzQtdGO0YnQuNGF0YHRjyDQsiDQvtCx0YrQtdC60YLQtSDQvtCx0YDQsNCx0L7RgtGH0LjQutC+0LJcclxuICAgIF9pbml0V2F0Y2hlcigpIHtcclxuICAgICAgICBsZXQgdHlwZXMgPSBPYmplY3Qua2V5cyh0aGlzLnRyaWdnZXJzKTtcclxuICAgICAgICB0eXBlcy5mb3JFYWNoKHR5cGUgPT4gZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcih0eXBlLCB0aGlzLl93YXRjaFRyaWdnZXIuYmluZCh0aGlzKSkpXHJcbiAgICB9XHJcblxyXG4gICAgLy8g0JzQtdGC0L7QtCDQtNC+0LHQsNCy0LvQtdC90LjRjyDQvdCwINGB0YLRgNCw0L3QuNGG0YMg0YHRgtC40LvQtdC5LCDQvdC10L7QsdGF0L7QtNC40LzRi9GFINC00LvRjyDRgNCw0LHQvtGC0YsgUGhvdG9Eb3dubG9hZFxyXG4gICAgX2luamVjdENTUygpIHtcclxuICAgICAgICBsZXQgc3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzdHlsZScpO1xyXG4gICAgICAgIHN0eWxlLmlkID0gdGhpcy5zdHlsZV9pZDtcclxuICAgICAgICBzdHlsZS50ZXh0Q29udGVudCA9IHRoaXMuX2NyZWF0ZVN0eWxlQ29udGVudCgpO1xyXG5cclxuICAgICAgICBkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKHN0eWxlKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLy8g0KLQvtGH0LrQsCDQstGF0L7QtNCwXHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIGNvbnNvbGUubG9nKCclYyVzJywgKHdpbmRvdy5sb2dfY29sb3IpID8gd2luZG93LmxvZ19jb2xvci5ibHVlIDogJycsICdQaG90b0Rvd25sb2FkOiBJbml0Jyk7XHJcblxyXG4gICAgICAgIC8vINCU0L7QsdCw0LLQu9GP0LXQvCDRgdGC0LjQu9C4IFBob3RvRG93bmxvYWRcclxuICAgICAgICB0aGlzLl9pbmplY3RDU1MoKTtcclxuXHJcbiAgICAgICAgLy8g0JjQvdC40YbQuNCw0LvQuNC30LjRgNGD0LXQvCDQvtCx0YDQsNCx0L7RgtGH0LjQutC4INGB0L7QsdGL0YLQuNC5XHJcbiAgICAgICAgdGhpcy5faW5pdFdhdGNoZXIoKTtcclxuICAgIH1cclxufSIsImltcG9ydCBQaG90b0Rvd25sb2FkIGZyb20gJy4vbW9kdWxlcy9waG90by1kb3dubG9hZCc7XHJcblxyXG5cclxud2luZG93LnBob3RvRG93bmxvYWQgPSBuZXcgUGhvdG9Eb3dubG9hZCgpOyIsIi8vZG93bmxvYWQuanMgdjQuMiwgYnkgZGFuZGF2aXM7IDIwMDgtMjAxNi4gW01JVF0gc2VlIGh0dHA6Ly9kYW5tbC5jb20vZG93bmxvYWQuaHRtbCBmb3IgdGVzdHMvdXNhZ2Vcbi8vIHYxIGxhbmRlZCBhIEZGK0Nocm9tZSBjb21wYXQgd2F5IG9mIGRvd25sb2FkaW5nIHN0cmluZ3MgdG8gbG9jYWwgdW4tbmFtZWQgZmlsZXMsIHVwZ3JhZGVkIHRvIHVzZSBhIGhpZGRlbiBmcmFtZSBhbmQgb3B0aW9uYWwgbWltZVxuLy8gdjIgYWRkZWQgbmFtZWQgZmlsZXMgdmlhIGFbZG93bmxvYWRdLCBtc1NhdmVCbG9iLCBJRSAoMTArKSBzdXBwb3J0LCBhbmQgd2luZG93LlVSTCBzdXBwb3J0IGZvciBsYXJnZXIrZmFzdGVyIHNhdmVzIHRoYW4gZGF0YVVSTHNcbi8vIHYzIGFkZGVkIGRhdGFVUkwgYW5kIEJsb2IgSW5wdXQsIGJpbmQtdG9nZ2xlIGFyaXR5LCBhbmQgbGVnYWN5IGRhdGFVUkwgZmFsbGJhY2sgd2FzIGltcHJvdmVkIHdpdGggZm9yY2UtZG93bmxvYWQgbWltZSBhbmQgYmFzZTY0IHN1cHBvcnQuIDMuMSBpbXByb3ZlZCBzYWZhcmkgaGFuZGxpbmcuXG4vLyB2NCBhZGRzIEFNRC9VTUQsIGNvbW1vbkpTLCBhbmQgcGxhaW4gYnJvd3NlciBzdXBwb3J0XG4vLyB2NC4xIGFkZHMgdXJsIGRvd25sb2FkIGNhcGFiaWxpdHkgdmlhIHNvbG8gVVJMIGFyZ3VtZW50IChzYW1lIGRvbWFpbi9DT1JTIG9ubHkpXG4vLyB2NC4yIGFkZHMgc2VtYW50aWMgdmFyaWFibGUgbmFtZXMsIGxvbmcgKG92ZXIgMk1CKSBkYXRhVVJMIHN1cHBvcnQsIGFuZCBoaWRkZW4gYnkgZGVmYXVsdCB0ZW1wIGFuY2hvcnNcbi8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ybmRtZS9kb3dubG9hZFxuXG4oZnVuY3Rpb24gKHJvb3QsIGZhY3RvcnkpIHtcblx0aWYgKHR5cGVvZiBkZWZpbmUgPT09ICdmdW5jdGlvbicgJiYgZGVmaW5lLmFtZCkge1xuXHRcdC8vIEFNRC4gUmVnaXN0ZXIgYXMgYW4gYW5vbnltb3VzIG1vZHVsZS5cblx0XHRkZWZpbmUoW10sIGZhY3RvcnkpO1xuXHR9IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0Jykge1xuXHRcdC8vIE5vZGUuIERvZXMgbm90IHdvcmsgd2l0aCBzdHJpY3QgQ29tbW9uSlMsIGJ1dFxuXHRcdC8vIG9ubHkgQ29tbW9uSlMtbGlrZSBlbnZpcm9ubWVudHMgdGhhdCBzdXBwb3J0IG1vZHVsZS5leHBvcnRzLFxuXHRcdC8vIGxpa2UgTm9kZS5cblx0XHRtb2R1bGUuZXhwb3J0cyA9IGZhY3RvcnkoKTtcblx0fSBlbHNlIHtcblx0XHQvLyBCcm93c2VyIGdsb2JhbHMgKHJvb3QgaXMgd2luZG93KVxuXHRcdHJvb3QuZG93bmxvYWQgPSBmYWN0b3J5KCk7XG4gIH1cbn0odGhpcywgZnVuY3Rpb24gKCkge1xuXG5cdHJldHVybiBmdW5jdGlvbiBkb3dubG9hZChkYXRhLCBzdHJGaWxlTmFtZSwgc3RyTWltZVR5cGUpIHtcblxuXHRcdHZhciBzZWxmID0gd2luZG93LCAvLyB0aGlzIHNjcmlwdCBpcyBvbmx5IGZvciBicm93c2VycyBhbnl3YXkuLi5cblx0XHRcdGRlZmF1bHRNaW1lID0gXCJhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW1cIiwgLy8gdGhpcyBkZWZhdWx0IG1pbWUgYWxzbyB0cmlnZ2VycyBpZnJhbWUgZG93bmxvYWRzXG5cdFx0XHRtaW1lVHlwZSA9IHN0ck1pbWVUeXBlIHx8IGRlZmF1bHRNaW1lLFxuXHRcdFx0cGF5bG9hZCA9IGRhdGEsXG5cdFx0XHR1cmwgPSAhc3RyRmlsZU5hbWUgJiYgIXN0ck1pbWVUeXBlICYmIHBheWxvYWQsXG5cdFx0XHRhbmNob3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiYVwiKSxcblx0XHRcdHRvU3RyaW5nID0gZnVuY3Rpb24oYSl7cmV0dXJuIFN0cmluZyhhKTt9LFxuXHRcdFx0bXlCbG9iID0gKHNlbGYuQmxvYiB8fCBzZWxmLk1vekJsb2IgfHwgc2VsZi5XZWJLaXRCbG9iIHx8IHRvU3RyaW5nKSxcblx0XHRcdGZpbGVOYW1lID0gc3RyRmlsZU5hbWUgfHwgXCJkb3dubG9hZFwiLFxuXHRcdFx0YmxvYixcblx0XHRcdHJlYWRlcjtcblx0XHRcdG15QmxvYj0gbXlCbG9iLmNhbGwgPyBteUJsb2IuYmluZChzZWxmKSA6IEJsb2IgO1xuXHQgIFxuXHRcdGlmKFN0cmluZyh0aGlzKT09PVwidHJ1ZVwiKXsgLy9yZXZlcnNlIGFyZ3VtZW50cywgYWxsb3dpbmcgZG93bmxvYWQuYmluZCh0cnVlLCBcInRleHQveG1sXCIsIFwiZXhwb3J0LnhtbFwiKSB0byBhY3QgYXMgYSBjYWxsYmFja1xuXHRcdFx0cGF5bG9hZD1bcGF5bG9hZCwgbWltZVR5cGVdO1xuXHRcdFx0bWltZVR5cGU9cGF5bG9hZFswXTtcblx0XHRcdHBheWxvYWQ9cGF5bG9hZFsxXTtcblx0XHR9XG5cblxuXHRcdGlmKHVybCAmJiB1cmwubGVuZ3RoPCAyMDQ4KXsgLy8gaWYgbm8gZmlsZW5hbWUgYW5kIG5vIG1pbWUsIGFzc3VtZSBhIHVybCB3YXMgcGFzc2VkIGFzIHRoZSBvbmx5IGFyZ3VtZW50XG5cdFx0XHRmaWxlTmFtZSA9IHVybC5zcGxpdChcIi9cIikucG9wKCkuc3BsaXQoXCI/XCIpWzBdO1xuXHRcdFx0YW5jaG9yLmhyZWYgPSB1cmw7IC8vIGFzc2lnbiBocmVmIHByb3AgdG8gdGVtcCBhbmNob3Jcblx0XHQgIFx0aWYoYW5jaG9yLmhyZWYuaW5kZXhPZih1cmwpICE9PSAtMSl7IC8vIGlmIHRoZSBicm93c2VyIGRldGVybWluZXMgdGhhdCBpdCdzIGEgcG90ZW50aWFsbHkgdmFsaWQgdXJsIHBhdGg6XG4gICAgICAgIFx0XHR2YXIgYWpheD1uZXcgWE1MSHR0cFJlcXVlc3QoKTtcbiAgICAgICAgXHRcdGFqYXgub3BlbiggXCJHRVRcIiwgdXJsLCB0cnVlKTtcbiAgICAgICAgXHRcdGFqYXgucmVzcG9uc2VUeXBlID0gJ2Jsb2InO1xuICAgICAgICBcdFx0YWpheC5vbmxvYWQ9IGZ1bmN0aW9uKGUpeyBcblx0XHRcdFx0ICBkb3dubG9hZChlLnRhcmdldC5yZXNwb25zZSwgZmlsZU5hbWUsIGRlZmF1bHRNaW1lKTtcblx0XHRcdFx0fTtcbiAgICAgICAgXHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgYWpheC5zZW5kKCk7fSwgMCk7IC8vIGFsbG93cyBzZXR0aW5nIGN1c3RvbSBhamF4IGhlYWRlcnMgdXNpbmcgdGhlIHJldHVybjpcblx0XHRcdCAgICByZXR1cm4gYWpheDtcblx0XHRcdH0gLy8gZW5kIGlmIHZhbGlkIHVybD9cblx0XHR9IC8vIGVuZCBpZiB1cmw/XG5cblxuXHRcdC8vZ28gYWhlYWQgYW5kIGRvd25sb2FkIGRhdGFVUkxzIHJpZ2h0IGF3YXlcblx0XHRpZigvXmRhdGE6KFtcXHcrLV0rXFwvW1xcdysuLV0rKT9bLDtdLy50ZXN0KHBheWxvYWQpKXtcblx0XHRcblx0XHRcdGlmKHBheWxvYWQubGVuZ3RoID4gKDEwMjQqMTAyNCoxLjk5OSkgJiYgbXlCbG9iICE9PSB0b1N0cmluZyApe1xuXHRcdFx0XHRwYXlsb2FkPWRhdGFVcmxUb0Jsb2IocGF5bG9hZCk7XG5cdFx0XHRcdG1pbWVUeXBlPXBheWxvYWQudHlwZSB8fCBkZWZhdWx0TWltZTtcblx0XHRcdH1lbHNle1x0XHRcdFxuXHRcdFx0XHRyZXR1cm4gbmF2aWdhdG9yLm1zU2F2ZUJsb2IgPyAgLy8gSUUxMCBjYW4ndCBkbyBhW2Rvd25sb2FkXSwgb25seSBCbG9iczpcblx0XHRcdFx0XHRuYXZpZ2F0b3IubXNTYXZlQmxvYihkYXRhVXJsVG9CbG9iKHBheWxvYWQpLCBmaWxlTmFtZSkgOlxuXHRcdFx0XHRcdHNhdmVyKHBheWxvYWQpIDsgLy8gZXZlcnlvbmUgZWxzZSBjYW4gc2F2ZSBkYXRhVVJMcyB1bi1wcm9jZXNzZWRcblx0XHRcdH1cblx0XHRcdFxuXHRcdH1lbHNley8vbm90IGRhdGEgdXJsLCBpcyBpdCBhIHN0cmluZyB3aXRoIHNwZWNpYWwgbmVlZHM/XG5cdFx0XHRpZigvKFtcXHg4MC1cXHhmZl0pLy50ZXN0KHBheWxvYWQpKXtcdFx0XHQgIFxuXHRcdFx0XHR2YXIgaT0wLCB0ZW1wVWlBcnI9IG5ldyBVaW50OEFycmF5KHBheWxvYWQubGVuZ3RoKSwgbXg9dGVtcFVpQXJyLmxlbmd0aDtcblx0XHRcdFx0Zm9yKGk7aTxteDsrK2kpIHRlbXBVaUFycltpXT0gcGF5bG9hZC5jaGFyQ29kZUF0KGkpO1xuXHRcdFx0IFx0cGF5bG9hZD1uZXcgbXlCbG9iKFt0ZW1wVWlBcnJdLCB7dHlwZTogbWltZVR5cGV9KTtcblx0XHRcdH1cdFx0ICBcblx0XHR9XG5cdFx0YmxvYiA9IHBheWxvYWQgaW5zdGFuY2VvZiBteUJsb2IgP1xuXHRcdFx0cGF5bG9hZCA6XG5cdFx0XHRuZXcgbXlCbG9iKFtwYXlsb2FkXSwge3R5cGU6IG1pbWVUeXBlfSkgO1xuXG5cblx0XHRmdW5jdGlvbiBkYXRhVXJsVG9CbG9iKHN0clVybCkge1xuXHRcdFx0dmFyIHBhcnRzPSBzdHJVcmwuc3BsaXQoL1s6OyxdLyksXG5cdFx0XHR0eXBlPSBwYXJ0c1sxXSxcblx0XHRcdGRlY29kZXI9IHBhcnRzWzJdID09IFwiYmFzZTY0XCIgPyBhdG9iIDogZGVjb2RlVVJJQ29tcG9uZW50LFxuXHRcdFx0YmluRGF0YT0gZGVjb2RlciggcGFydHMucG9wKCkgKSxcblx0XHRcdG14PSBiaW5EYXRhLmxlbmd0aCxcblx0XHRcdGk9IDAsXG5cdFx0XHR1aUFycj0gbmV3IFVpbnQ4QXJyYXkobXgpO1xuXG5cdFx0XHRmb3IoaTtpPG14OysraSkgdWlBcnJbaV09IGJpbkRhdGEuY2hhckNvZGVBdChpKTtcblxuXHRcdFx0cmV0dXJuIG5ldyBteUJsb2IoW3VpQXJyXSwge3R5cGU6IHR5cGV9KTtcblx0XHQgfVxuXG5cdFx0ZnVuY3Rpb24gc2F2ZXIodXJsLCB3aW5Nb2RlKXtcblxuXHRcdFx0aWYgKCdkb3dubG9hZCcgaW4gYW5jaG9yKSB7IC8vaHRtbDUgQVtkb3dubG9hZF1cblx0XHRcdFx0YW5jaG9yLmhyZWYgPSB1cmw7XG5cdFx0XHRcdGFuY2hvci5zZXRBdHRyaWJ1dGUoXCJkb3dubG9hZFwiLCBmaWxlTmFtZSk7XG5cdFx0XHRcdGFuY2hvci5jbGFzc05hbWUgPSBcImRvd25sb2FkLWpzLWxpbmtcIjtcblx0XHRcdFx0YW5jaG9yLmlubmVySFRNTCA9IFwiZG93bmxvYWRpbmcuLi5cIjtcblx0XHRcdFx0YW5jaG9yLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcblx0XHRcdFx0ZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChhbmNob3IpO1xuXHRcdFx0XHRzZXRUaW1lb3V0KGZ1bmN0aW9uKCkge1xuXHRcdFx0XHRcdGFuY2hvci5jbGljaygpO1xuXHRcdFx0XHRcdGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQoYW5jaG9yKTtcblx0XHRcdFx0XHRpZih3aW5Nb2RlPT09dHJ1ZSl7c2V0VGltZW91dChmdW5jdGlvbigpeyBzZWxmLlVSTC5yZXZva2VPYmplY3RVUkwoYW5jaG9yLmhyZWYpO30sIDI1MCApO31cblx0XHRcdFx0fSwgNjYpO1xuXHRcdFx0XHRyZXR1cm4gdHJ1ZTtcblx0XHRcdH1cblxuXHRcdFx0Ly8gaGFuZGxlIG5vbi1hW2Rvd25sb2FkXSBzYWZhcmkgYXMgYmVzdCB3ZSBjYW46XG5cdFx0XHRpZigvKFZlcnNpb24pXFwvKFxcZCspXFwuKFxcZCspKD86XFwuKFxcZCspKT8uKlNhZmFyaVxcLy8udGVzdChuYXZpZ2F0b3IudXNlckFnZW50KSkge1xuXHRcdFx0XHRpZigvXmRhdGE6Ly50ZXN0KHVybCkpXHR1cmw9XCJkYXRhOlwiK3VybC5yZXBsYWNlKC9eZGF0YTooW1xcd1xcL1xcLVxcK10rKS8sIGRlZmF1bHRNaW1lKTtcblx0XHRcdFx0aWYoIXdpbmRvdy5vcGVuKHVybCkpeyAvLyBwb3B1cCBibG9ja2VkLCBvZmZlciBkaXJlY3QgZG93bmxvYWQ6XG5cdFx0XHRcdFx0aWYoY29uZmlybShcIkRpc3BsYXlpbmcgTmV3IERvY3VtZW50XFxuXFxuVXNlIFNhdmUgQXMuLi4gdG8gZG93bmxvYWQsIHRoZW4gY2xpY2sgYmFjayB0byByZXR1cm4gdG8gdGhpcyBwYWdlLlwiKSl7IGxvY2F0aW9uLmhyZWY9dXJsOyB9XG5cdFx0XHRcdH1cblx0XHRcdFx0cmV0dXJuIHRydWU7XG5cdFx0XHR9XG5cblx0XHRcdC8vZG8gaWZyYW1lIGRhdGFVUkwgZG93bmxvYWQgKG9sZCBjaCtGRik6XG5cdFx0XHR2YXIgZiA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJpZnJhbWVcIik7XG5cdFx0XHRkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGYpO1xuXG5cdFx0XHRpZighd2luTW9kZSAmJiAvXmRhdGE6Ly50ZXN0KHVybCkpeyAvLyBmb3JjZSBhIG1pbWUgdGhhdCB3aWxsIGRvd25sb2FkOlxuXHRcdFx0XHR1cmw9XCJkYXRhOlwiK3VybC5yZXBsYWNlKC9eZGF0YTooW1xcd1xcL1xcLVxcK10rKS8sIGRlZmF1bHRNaW1lKTtcblx0XHRcdH1cblx0XHRcdGYuc3JjPXVybDtcblx0XHRcdHNldFRpbWVvdXQoZnVuY3Rpb24oKXsgZG9jdW1lbnQuYm9keS5yZW1vdmVDaGlsZChmKTsgfSwgMzMzKTtcblxuXHRcdH0vL2VuZCBzYXZlclxuXG5cblxuXG5cdFx0aWYgKG5hdmlnYXRvci5tc1NhdmVCbG9iKSB7IC8vIElFMTArIDogKGhhcyBCbG9iLCBidXQgbm90IGFbZG93bmxvYWRdIG9yIFVSTClcblx0XHRcdHJldHVybiBuYXZpZ2F0b3IubXNTYXZlQmxvYihibG9iLCBmaWxlTmFtZSk7XG5cdFx0fVxuXG5cdFx0aWYoc2VsZi5VUkwpeyAvLyBzaW1wbGUgZmFzdCBhbmQgbW9kZXJuIHdheSB1c2luZyBCbG9iIGFuZCBVUkw6XG5cdFx0XHRzYXZlcihzZWxmLlVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYiksIHRydWUpO1xuXHRcdH1lbHNle1xuXHRcdFx0Ly8gaGFuZGxlIG5vbi1CbG9iKCkrbm9uLVVSTCBicm93c2Vyczpcblx0XHRcdGlmKHR5cGVvZiBibG9iID09PSBcInN0cmluZ1wiIHx8IGJsb2IuY29uc3RydWN0b3I9PT10b1N0cmluZyApe1xuXHRcdFx0XHR0cnl7XG5cdFx0XHRcdFx0cmV0dXJuIHNhdmVyKCBcImRhdGE6XCIgKyAgbWltZVR5cGUgICArIFwiO2Jhc2U2NCxcIiAgKyAgc2VsZi5idG9hKGJsb2IpICApO1xuXHRcdFx0XHR9Y2F0Y2goeSl7XG5cdFx0XHRcdFx0cmV0dXJuIHNhdmVyKCBcImRhdGE6XCIgKyAgbWltZVR5cGUgICArIFwiLFwiICsgZW5jb2RlVVJJQ29tcG9uZW50KGJsb2IpICApO1xuXHRcdFx0XHR9XG5cdFx0XHR9XG5cblx0XHRcdC8vIEJsb2IgYnV0IG5vdCBVUkwgc3VwcG9ydDpcblx0XHRcdHJlYWRlcj1uZXcgRmlsZVJlYWRlcigpO1xuXHRcdFx0cmVhZGVyLm9ubG9hZD1mdW5jdGlvbihlKXtcblx0XHRcdFx0c2F2ZXIodGhpcy5yZXN1bHQpO1xuXHRcdFx0fTtcblx0XHRcdHJlYWRlci5yZWFkQXNEYXRhVVJMKGJsb2IpO1xuXHRcdH1cblx0XHRyZXR1cm4gdHJ1ZTtcblx0fTsgLyogZW5kIGRvd25sb2FkKCkgKi9cbn0pKTtcbiJdfQ=="}