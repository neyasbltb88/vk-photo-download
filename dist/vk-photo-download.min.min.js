!function r(i,s,l){function c(t,e){if(!s[t]){if(!i[t]){var n="function"==typeof require&&require;if(!e&&n)return n(t,!0);if(d)return d(t,!0);var o=new Error("Cannot find module '"+t+"'");throw o.code="MODULE_NOT_FOUND",o}var a=s[t]={exports:{}};i[t][0].call(a.exports,function(e){return c(i[t][1][e]||e)},a,a.exports,r,i,s,l)}return s[t].exports}for(var d="function"==typeof require&&require,e=0;e<l.length;e++)c(l[e]);return c}({1:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o,a=(o=e("downloadjs"))&&o.__esModule?o:{default:o};function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var i=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.PhotoDownload=e.PhotoDownload,this.default_event_name="click",this.handlers={testHandler:this._testHandler,preventHandler:this._preventHandler,preventStopHandler:this._preventStopHandler,newTabHandler:this._newTabHandler,downloadHandler:this._downloadHandler}}var e,n,o;return e=t,(n=[{key:"set",value:function(t,e){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.default_event_name;if(!t)return!1;var a=!0;return this.removeAll(t,o),e instanceof Array?e.forEach(function(e){n.add(t,e,o)}):"string"==typeof e?this.add(t,e,o):a=!1,a}},{key:"add",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.default_event_name;return!!(e&&t&&this.handlers[t])&&(e.addEventListener(n,this.handlers[t]),!0)}},{key:"remove",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.default_event_name;return!!(e&&t&&this.handlers[t])&&(e.removeEventListener(n,this.handlers[t]),!0)}},{key:"removeAll",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.default_event_name;if(!e)return!1;for(var n in this.handlers)e.removeEventListener(t,this.handlers[n]);return!0}},{key:"getHandlersNames",value:function(){return Object.keys(this.handlers)}},{key:"getHandlers",value:function(){return this.handlers}},{key:"getHandler",value:function(e){return this.handlers[e]}},{key:"_testHandler",value:function(){alert("_testHandler")}},{key:"_preventHandler",value:function(e){return e.preventDefault(),!1}},{key:"_preventStopHandler",value:function(e){return e.preventDefault(),e.stopPropagation(),e.stopImmediatePropagation(),!1}},{key:"_newTabHandler",value:function(){return!0}},{key:"_downloadHandler",value:function(e){return e.preventDefault(),console.log("_downloadHandler"),(0,a.default)(e.currentTarget.href),!1}}])&&r(e.prototype,n),o&&r(e,o),t}();n.default=i},{downloadjs:5}],2:[function(e,t,n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var a=o(e("./templates")),r=o(e("./handlers"));function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}var s=function(){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n);var t=this;this.imgContainer_id="pv_photo",this.selectors={photoDownload_id:"PhotoDownload",imgContainer_class:"pv_image_wrap",style_id:"PhotoDownloadStyle",PhotoDownload_btn:"PhotoDownload_btn",PhotoDownload_icon:"PhotoDownload_icon",PhotoDownload_size:"PhotoDownload_size",non_size:"non_size",ready:"ready"},this.template=new a.default({selectors:this.selectors}),this.triggers={mouseover:[{type:"id",selector:this.imgContainer_id,handler:this._updateBtn,child:!0},{type:"class",selector:this.selectors.PhotoDownload_btn,handler:this._updateBtn,child:!0}]},this.flag_download={_flag:e.download,get flag(){return this._flag},set flag(e){"boolean"==typeof e&&(this._flag=e,t._addBtnHandlers(this._flag))}},this.handlers=new r.default({PhotoDownload:this}),this.parent_wrap=null,this.wrap=null,this.init()}var e,t,o;return e=n,(t=[{key:"_addBtnHandlers",value:function(){if(!this.wrap)return!1;var e=this.wrap.querySelector("."+this.selectors.PhotoDownload_btn);this.flag_download.flag?this.handlers.set(e,"downloadHandler"):this.handlers.set(e,"newTabHandler")}},{key:"_updateBtn",value:function(e){this.parent=e.closest("."+this.selectors.imgContainer_class),this.parent.querySelector("#"+this.selectors.photoDownload_id)||(this.wrap=this.template.createDownloadContainer(this.parent),this._addBtnHandlers());var t=this.wrap.querySelector("."+this.selectors.PhotoDownload_btn),n=this.wrap.querySelector("."+this.selectors.PhotoDownload_size),o=window.Photoview.genData(window.cur.pvCurPhoto);t.href!==o.src&&(t.href=o.src,this.template.setSize(n,o))}},{key:"_checkComplianceChild",value:function(e,t){var n="id"===t.type?e.closest("#"+t.selector):e.closest("."+t.selector);n&&this._checkComplianceTarget(n,t)}},{key:"_checkComplianceTarget",value:function(e,t){var n=!1;return"id"===t.type&&e.id===t.selector&&(n=!0,t.handler&&t.handler.call(this,e)),"class"===t.type&&e.classList.contains(t.selector)&&(n=!0,t.handler&&t.handler.call(this,e)),n}},{key:"_watchTrigger",value:function(e){var t=this,n=this.triggers[e.type];if(void 0!==n){var o=e.target;n.forEach(function(e){!t._checkComplianceTarget(o,e)&&e.child&&t._checkComplianceChild(o,e)})}}},{key:"_initWatcher",value:function(){var t=this;Object.keys(this.triggers).forEach(function(e){return document.addEventListener(e,t._watchTrigger.bind(t))})}},{key:"_injectCSS",value:function(){var e=document.createElement("style");e.id=this.selectors.style_id,e.textContent=this.template.getStyleContent(),document.head.appendChild(e)}},{key:"init",value:function(){console.log("%c%s",window.log_color?window.log_color.blue:"","PhotoDownload: Init"),this._injectCSS(),this._initWatcher()}}])&&i(e.prototype,t),o&&i(e,o),n}();n.default=s},{"./handlers":1,"./templates":3}],3:[function(e,t,n){"use strict";function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var o=function(){function t(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),this.selectors=e.selectors,this.icons={_colors:{green:"#00B75A",red:"#F92672",white:"#FFFFFF",yellow:"#FFC000"},_prefix:"data:image/svg+xml;charset=utf-8,",_template:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" version="1.1" viewBox="0 0 16 16">\n                            <path fill="{{color}}" d="M 4,0 4,8 0,8 8,16 16,8 12,8 12,0 4,0 z"/>\n                        </svg>',_temp:function(e){return this._template.replace(/\{\{.*\}\}/gm,e||"white")},get:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this._colors[e]?this._colors[e]:e,o=this._temp(n).replace(/[\s]{2,}/gm," ");return t?this._prefix+encodeURIComponent(o):o}}}var e,n,o;return e=t,(n=[{key:"setSize",value:function(e,t){t.width&&t.height?(e.classList.remove(this.selectors.non_size),e.textContent="".concat(t.width,"x").concat(t.height)):(e.classList.add(this.selectors.non_size),e.textContent="")}},{key:"createDownloadContainer",value:function(e){var t=document.createElement("div");return t.id=this.selectors.photoDownload_id,t.innerHTML=this.getInnerElems(),setTimeout(function(){t.classList.add("ready")},0),e.appendChild(t),t}},{key:"getInnerElems",value:function(){return'\n            <a class="'.concat(this.selectors.PhotoDownload_btn,'" href="#!" target="_blank" draggable="false">\n                <div class="').concat(this.selectors.PhotoDownload_icon,'"></div>\n                <div class="').concat(this.selectors.PhotoDownload_size,'"></div>\n            </a>\n        ')}},{key:"getStyleContent",value:function(){return"\n        #".concat(this.selectors.photoDownload_id," {\n            background-color: #000;\n            border-top-left-radius: 4px;\n            position: absolute;\n            bottom: 0;\n            left: 100%;\n            opacity: 0;\n            transform: translate3d(-38px, 0, 1px);\n            will-change: transform, opacity;\n            transition: opacity .25s ease-in-out, transform .25s ease-in-out !important;\n        }\n        .").concat(this.selectors.imgContainer_class,":hover #").concat(this.selectors.photoDownload_id,".").concat(this.selectors.ready," {\n            opacity: .3;\n        }\n        .").concat(this.selectors.imgContainer_class," #").concat(this.selectors.photoDownload_id,".").concat(this.selectors.ready,":hover {\n            opacity: .8;\n            transform: translate3d(-100%, 0, 1px);\n        }\n        .").concat(this.selectors.PhotoDownload_btn," {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n        }\n        .").concat(this.selectors.PhotoDownload_btn,":hover {\n            text-decoration: none;\n        }\n        .").concat(this.selectors.PhotoDownload_icon," {\n            background-image: url('").concat(this.icons.get("white"),"');\n            background-size: contain;\n            background-repeat: no-repeat;\n            height: 18px;\n            width: 18px;\n        }\n        .").concat(this.selectors.PhotoDownload_btn,":hover .").concat(this.selectors.PhotoDownload_icon," {\n            background-image: url('").concat(this.icons.get("green"),"');\n        }\n        #").concat(this.selectors.photoDownload_id," .").concat(this.selectors.PhotoDownload_size,":not(.").concat(this.selectors.non_size,") {\n            padding-left: 10px;\n            color: #C3CFE0 !important;\n        }\n        ")}}])&&a(e.prototype,n),o&&a(e,o),t}();n.default=o},{}],4:[function(e,t,n){"use strict";var o,a=(o=e("./modules/photo-download"))&&o.__esModule?o:{default:o};window.photoDownload=new a.default({download:!0})},{"./modules/photo-download":2}],5:[function(e,t,n){var o,a;o=this,a=function(){return function t(e,n,o){var a,r,i=window,s="application/octet-stream",l=o||s,c=e,d=!n&&!o&&c,h=document.createElement("a"),u=function(e){return String(e)},f=i.Blob||i.MozBlob||i.WebKitBlob||u,p=n||"download";if(f=f.call?f.bind(i):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),d&&d.length<2048&&(p=d.split("/").pop().split("?")[0],h.href=d,-1!==h.href.indexOf(d))){var v=new XMLHttpRequest;return v.open("GET",d,!0),v.responseType="blob",v.onload=function(e){t(e.target.response,p,s)},setTimeout(function(){v.send()},0),v}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(2096103.424<c.length&&f!==u))return navigator.msSaveBlob?navigator.msSaveBlob(m(c),p):y(c);l=(c=m(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var w=0,_=new Uint8Array(c.length),g=_.length;w<g;++w)_[w]=c.charCodeAt(w);c=new f([_],{type:l})}function m(e){for(var t=e.split(/[:;,]/),n=t[1],o=("base64"==t[2]?atob:decodeURIComponent)(t.pop()),a=o.length,r=0,i=new Uint8Array(a);r<a;++r)i[r]=o.charCodeAt(r);return new f([i],{type:n})}function y(e,t){if("download"in h)return h.href=e,h.setAttribute("download",p),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout(function(){h.click(),document.body.removeChild(h),!0===t&&setTimeout(function(){i.URL.revokeObjectURL(h.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var n=document.createElement("iframe");document.body.appendChild(n),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,s)),n.src=e,setTimeout(function(){document.body.removeChild(n)},333)}if(a=c instanceof f?c:new f([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(a,p);if(i.URL)y(i.URL.createObjectURL(a),!0);else{if("string"==typeof a||a.constructor===u)try{return y("data:"+l+";base64,"+i.btoa(a))}catch(e){return y("data:"+l+","+encodeURIComponent(a))}(r=new FileReader).onload=function(e){y(this.result)},r.readAsDataURL(a)}return!0}},"function"==typeof define&&define.amd?define([],a):"object"==typeof n?t.exports=a():o.download=a()},{}]},{},[4]);