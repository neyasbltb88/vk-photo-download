!function i(r,s,l){function c(e,t){if(!s[e]){if(!r[e]){var o="function"==typeof require&&require;if(!t&&o)return o(e,!0);if(d)return d(e,!0);var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}var a=s[e]={exports:{}};r[e][0].call(a.exports,function(t){return c(r[e][1][t]||t)},a,a.exports,i,r,s,l)}return s[e].exports}for(var d="function"==typeof require&&require,t=0;t<l.length;t++)c(l[t]);return c}({1:[function(t,e,o){"use strict";Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var a=n(t("downloadjs")),i=n(t("./templates"));function n(t){return t&&t.__esModule?t:{default:t}}function r(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}var s=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.imgContainer_id="pv_photo",this.flag_download=t.download,this.selectors={photoDownload_id:"PhotoDownload",imgContainer_class:"pv_image_wrap",style_id:"PhotoDownloadStyle",PhotoDownload_btn:"PhotoDownload_btn",PhotoDownload_icon:"PhotoDownload_icon",PhotoDownload_size:"PhotoDownload_size",non_size:"non_size",ready:"ready"},this.template=new i.default({selectors:this.selectors}),this.triggers={mouseover:[{type:"id",selector:this.imgContainer_id,handler:this._updateBtn,child:!0},{type:"class",selector:this.selectors.PhotoDownload_btn,handler:this._updateBtn,child:!0}]},this.last_image_data={src:null,width:null,height:null},this.init()}var t,o,n;return t=e,(o=[{key:"_updateBtn",value:function(t){var e=t.closest("."+this.selectors.imgContainer_class);e.querySelector("#"+this.selectors.photoDownload_id)||this._createDownloadContainer(t);var o=e.querySelector("."+this.selectors.PhotoDownload_btn),n=e.querySelector("."+this.selectors.PhotoDownload_size);this.last_image_data=window.Photoview.genData(window.cur.pvCurPhoto),o.href!==this.last_image_data.src&&(o.href=this.last_image_data.src,this.flag_download?o.onclick=function(t){return t.preventDefault(),(0,a.default)(t.currentTarget.href),!1}:o.onclick=null,this.last_image_data.width&&this.last_image_data.height?(n.classList.remove(this.selectors.non_size),n.textContent="".concat(this.last_image_data.width,"x").concat(this.last_image_data.height)):(n.classList.add(this.selectors.non_size),n.textContent=""))}},{key:"_createDownloadContainer",value:function(t){var e=t.closest("."+this.selectors.imgContainer_class),o=document.createElement("div");o.id=this.selectors.photoDownload_id,o.innerHTML=this.template.getInnerElems(),setTimeout(function(){o.classList.add("ready")},0),e.appendChild(o)}},{key:"_checkComplianceChild",value:function(t,e){var o="id"===e.type?t.closest("#"+e.selector):t.closest("."+e.selector);o&&this._checkComplianceTarget(o,e)}},{key:"_checkComplianceTarget",value:function(t,e){var o=!1;return"id"===e.type&&t.id===e.selector&&(o=!0,e.handler&&e.handler.call(this,t)),"class"===e.type&&t.classList.contains(e.selector)&&(o=!0,e.handler&&e.handler.call(this,t)),o}},{key:"_watchTrigger",value:function(t){var e=this,o=this.triggers[t.type];if(void 0!==o){var n=t.target;o.forEach(function(t){!e._checkComplianceTarget(n,t)&&t.child&&e._checkComplianceChild(n,t)})}}},{key:"_initWatcher",value:function(){var e=this;Object.keys(this.triggers).forEach(function(t){return document.addEventListener(t,e._watchTrigger.bind(e))})}},{key:"_injectCSS",value:function(){var t=document.createElement("style");t.id=this.selectors.style_id,t.textContent=this.template.getStyleContent(),document.head.appendChild(t)}},{key:"init",value:function(){console.log("%c%s",window.log_color?window.log_color.blue:"","PhotoDownload: Init"),this._injectCSS(),this._initWatcher()}}])&&r(t.prototype,o),n&&r(t,n),e}();o.default=s},{"./templates":2,downloadjs:4}],2:[function(t,e,o){"use strict";function a(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}Object.defineProperty(o,"__esModule",{value:!0}),o.default=void 0;var n=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.selectors=t.selectors,this.icons={_colors:{green:"#00B75A",red:"#F92672",white:"#FFFFFF",yellow:"#FFC000"},_prefix:"data:image/svg+xml;charset=utf-8,",_template:'<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" version="1.1" viewBox="0 0 16 16">\n                                <path fill="{{color}}" d="M 4,0 4,8 0,8 8,16 16,8 12,8 12,0 4,0 z"/>\n                            </svg>',_temp:function(t){return this._template.replace(/\{\{.*\}\}/gm,t||"white")},get:function(t){var e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this._colors[t]?this._colors[t]:t,n=this._temp(o).replace(/[\s]{2,}/gm," ");return e?this._prefix+encodeURIComponent(n):n}}}var t,o,n;return t=e,(o=[{key:"getInnerElems",value:function(){return'\n            <a class="'.concat(this.selectors.PhotoDownload_btn,'" href="#!" target="_blank" draggable="false">\n                <div class="').concat(this.selectors.PhotoDownload_icon,'"></div>\n                <div class="').concat(this.selectors.PhotoDownload_size,'"></div>\n            </a>\n        ')}},{key:"getStyleContent",value:function(){return"\n        #".concat(this.selectors.photoDownload_id," {\n            background-color: #000;\n            border-top-left-radius: 4px;\n            position: absolute;\n            bottom: 0;\n            left: 100%;\n            opacity: 0;\n            transform: translate3d(-38px, 0, 1px);\n            will-change: transform, opacity;\n            transition: opacity .25s ease-in-out, transform .25s ease-in-out !important;\n        }\n        .").concat(this.selectors.imgContainer_class,":hover #").concat(this.selectors.photoDownload_id,".").concat(this.selectors.ready," {\n            opacity: .3;\n        }\n        .").concat(this.selectors.imgContainer_class," #").concat(this.selectors.photoDownload_id,".").concat(this.selectors.ready,":hover {\n            opacity: .8;\n            transform: translate3d(-100%, 0, 1px);\n        }\n        .").concat(this.selectors.PhotoDownload_btn," {\n            display: flex;\n            align-items: center;\n            padding: 10px;\n        }\n        .").concat(this.selectors.PhotoDownload_btn,":hover {\n            text-decoration: none;\n        }\n        .").concat(this.selectors.PhotoDownload_icon," {\n            background-image: url('").concat(this.icons.get("white"),"');\n            background-size: contain;\n            background-repeat: no-repeat;\n            height: 18px;\n            width: 18px;\n        }\n        .").concat(this.selectors.PhotoDownload_btn,":hover .").concat(this.selectors.PhotoDownload_icon," {\n            background-image: url('").concat(this.icons.get("green"),"');\n        }\n        #").concat(this.selectors.photoDownload_id," .").concat(this.selectors.PhotoDownload_size,":not(.").concat(this.selectors.non_size,") {\n            padding-left: 10px;\n            color: #C3CFE0 !important;\n        }\n        ")}}])&&a(t.prototype,o),n&&a(t,n),e}();o.default=n},{}],3:[function(t,e,o){"use strict";var n,a=(n=t("./modules/photo-download"))&&n.__esModule?n:{default:n};window.photoDownload=new a.default({download:!0})},{"./modules/photo-download":1}],4:[function(t,e,o){var n,a;n=this,a=function(){return function e(t,o,n){var a,i,r=window,s="application/octet-stream",l=n||s,c=t,d=!o&&!n&&c,h=document.createElement("a"),u=function(t){return String(t)},f=r.Blob||r.MozBlob||r.WebKitBlob||u,p=o||"download";if(f=f.call?f.bind(r):Blob,"true"===String(this)&&(l=(c=[c,l])[0],c=c[1]),d&&d.length<2048&&(p=d.split("/").pop().split("?")[0],h.href=d,-1!==h.href.indexOf(d))){var w=new XMLHttpRequest;return w.open("GET",d,!0),w.responseType="blob",w.onload=function(t){e(t.target.response,p,s)},setTimeout(function(){w.send()},0),w}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(c)){if(!(2096103.424<c.length&&f!==u))return navigator.msSaveBlob?navigator.msSaveBlob(v(c),p):y(c);l=(c=v(c)).type||s}else if(/([\x80-\xff])/.test(c)){for(var g=0,_=new Uint8Array(c.length),m=_.length;g<m;++g)_[g]=c.charCodeAt(g);c=new f([_],{type:l})}function v(t){for(var e=t.split(/[:;,]/),o=e[1],n=("base64"==e[2]?atob:decodeURIComponent)(e.pop()),a=n.length,i=0,r=new Uint8Array(a);i<a;++i)r[i]=n.charCodeAt(i);return new f([r],{type:o})}function y(t,e){if("download"in h)return h.href=t,h.setAttribute("download",p),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout(function(){h.click(),document.body.removeChild(h),!0===e&&setTimeout(function(){r.URL.revokeObjectURL(h.href)},250)},66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,s)),window.open(t)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=t),!0;var o=document.createElement("iframe");document.body.appendChild(o),!e&&/^data:/.test(t)&&(t="data:"+t.replace(/^data:([\w\/\-\+]+)/,s)),o.src=t,setTimeout(function(){document.body.removeChild(o)},333)}if(a=c instanceof f?c:new f([c],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(a,p);if(r.URL)y(r.URL.createObjectURL(a),!0);else{if("string"==typeof a||a.constructor===u)try{return y("data:"+l+";base64,"+r.btoa(a))}catch(t){return y("data:"+l+","+encodeURIComponent(a))}(i=new FileReader).onload=function(t){y(this.result)},i.readAsDataURL(a)}return!0}},"function"==typeof define&&define.amd?define([],a):"object"==typeof o?e.exports=a():n.download=a()},{}]},{},[3]);